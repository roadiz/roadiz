/*! rozier-backend-theme 2017-12-08 10:36:41 */
function PointerEventsPolyfill(a){if(this.options={selector:"*",mouseEvents:["click","dblclick","mousedown","mouseup"],usePolyfillIf:function(){if("Microsoft Internet Explorer"==navigator.appName){if(null!=navigator.userAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/)){if(parseFloat(RegExp.$1)<11)return!0}}return!1}},a){var b=this;$.each(a,function(a,c){b.options[a]=c})}this.options.usePolyfillIf()&&this.register_mouse_events()}var AutoUpdate=function(){var a=this;a.$section=$("#auto-update"),a.$section.length&&a.init()};AutoUpdate.prototype.init=function(){var a=this;"undefined"!=typeof nextStep&&"undefined"!=typeof nextStepDescription&&null!==nextStep&&null!==nextStepDescription&&(a.$button=a.$section.find("#update-done-button"),a.$buttonIcon=a.$button.find("i"),a.$buttonText=a.$button.find(".text"),a.$progressBar=$("#update-progress-bar"),a.$progressBarInner=a.$progressBar.find(".uk-progress-bar"),a.$progressMessage=a.$section.find("#update-progress-message"),a.$button.on("click",function(a){return a.preventDefault(),!1}),a.loadStep(5,nextStep,nextStepDescription))},AutoUpdate.prototype.loadStep=function(a,b,c){var d=this;d.displayProgress(a,c),$.ajax({url:b,type:"get",dataType:"json",cache:!1}).done(function(a){void 0!==a.progress&&(void 0!==a.complete&&a.complete===!0?d.finish(a.progress,a.nextStepDescription):d.loadStep(a.progress,a.nextStepRoute,a.nextStepDescription))}).fail(function(a){void 0!==a.responseJSON&&d.$progressBarInner.html(a.responseJSON.message),d.buttonFail(),d.$progressBar.removeClass("uk-progress-striped uk-active"),d.$progressBar.addClass("uk-progress-danger")})},AutoUpdate.prototype.displayProgress=function(a,b){var c=this;c.$progressBarInner.width(a+"%"),c.$progressMessage.html(b)},AutoUpdate.prototype.finish=function(a,b){var c=this;c.displayProgress(a,b),c.buttonOK(),c.$progressBar.removeClass("uk-progress-striped uk-active"),c.$progressBar.addClass("uk-progress-success")},AutoUpdate.prototype.buttonOK=function(){var a=this;a.$buttonIcon.removeClass("uk-icon-spin"),a.$buttonIcon.removeClass("uk-icon-refresh"),a.$buttonIcon.addClass("uk-icon-check"),a.$button.addClass("uk-button-primary"),a.$button.off("click");var b=a.$button.attr("data-done-text");a.$buttonText.html(b)},AutoUpdate.prototype.buttonFail=function(){var a=this;a.$buttonIcon.removeClass("uk-icon-spin"),a.$buttonIcon.removeClass("uk-icon-refresh"),a.$buttonIcon.addClass("uk-icon-warning"),a.$button.addClass("uk-button-danger"),a.$button.off("click");var b=a.$button.attr("data-done-text");a.$buttonText.html(b)};var NodeTreeContextActions=function(){var a=this,b=$(".tree-contextualmenu");a.$links=b.find(".node-actions a"),a.$nodeMoveFirstLinks=b.find("a.move-node-first-position"),a.$nodeMoveLastLinks=b.find("a.move-node-last-position"),a.$links.length&&a.bind()};NodeTreeContextActions.prototype.bind=function(){var a=this,b=$.proxy(a.onClick,a);a.$links.off("click",b),a.$links.on("click",b);var c=$.proxy(a.moveNodeToPosition,a,"first");a.$nodeMoveFirstLinks.off("click"),a.$nodeMoveFirstLinks.on("click",c);var d=$.proxy(a.moveNodeToPosition,a,"last");a.$nodeMoveLastLinks.off("click"),a.$nodeMoveLastLinks.on("click",d)},NodeTreeContextActions.prototype.onClick=function(a){var b=this;a.preventDefault();var c=$(a.currentTarget),d=$(c.parents(".nodetree-element")[0]),e=parseInt(d.data("node-id")),f=(c.attr("data-action"),c.attr("data-status")),g=c.attr("data-value"),h=c.attr("data-action");void 0!==h&&(Rozier.lazyload.canvasLoader.show(),void 0===f||void 0===g||isNaN(g)?"duplicate"==h&&b.duplicateNode(e):b.changeStatus(e,f,parseInt(g)))},NodeTreeContextActions.prototype.changeStatus=function(a,b,c){var d=this;d.ajaxTimeout&&clearTimeout(d.ajaxTimeout),d.ajaxTimeout=window.setTimeout(function(){var d={_token:Rozier.ajaxToken,_action:"nodeChangeStatus",nodeId:a,statusName:b,statusValue:c};$.ajax({url:Rozier.routes.nodesStatusesAjax,type:"post",dataType:"json",data:d}).done(function(a){Rozier.refreshAllNodeTrees(),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){a=JSON.parse(a.responseText),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){Rozier.lazyload.canvasLoader.hide()})},100)},NodeTreeContextActions.prototype.duplicateNode=function(a){var b=this;b.ajaxTimeout&&clearTimeout(b.ajaxTimeout),b.ajaxTimeout=window.setTimeout(function(){var b={_token:Rozier.ajaxToken,_action:"duplicate",nodeId:a};$.ajax({url:Rozier.routes.nodeAjaxEdit.replace("%nodeId%",a),type:"POST",dataType:"json",data:b}).done(function(a){Rozier.refreshAllNodeTrees(),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)}).always(function(){Rozier.lazyload.canvasLoader.hide()})},100)},NodeTreeContextActions.prototype.moveNodeToPosition=function(a,b){Rozier.lazyload.canvasLoader.show();var c=$($(b.currentTarget).parents(".nodetree-element")[0]),d=parseInt(c.data("node-id")),e=parseInt(c.parents("ul").first().data("parent-node-id")),f={_token:Rozier.ajaxToken,_action:"updatePosition",nodeId:d};void 0!==a&&"first"==a?f.firstPosition=!0:void 0!==a&&"last"==a&&(f.lastPosition=!0),isNaN(e)&&(e=null),f.newParent=e,$.ajax({url:Rozier.routes.nodeAjaxEdit.replace("%nodeId%",d),type:"POST",dataType:"json",data:f}).done(function(a){Rozier.refreshAllNodeTrees(),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){Rozier.lazyload.canvasLoader.hide()})};var DocumentsBulk=function(){var a=this;a.$documentsCheckboxes=$("input.document-checkbox"),a.$documentsIdBulkFolders=$("input.document-id-bulk-folder"),a.$actionsMenu=$(".documents-bulk-actions"),a.$documentsFolderButton=$(".uk-button-bulk-folder-documents"),a.$documentsFolderCont=$(".documents-bulk-folder-cont"),a.$documentsSelectAll=$(".uk-button-select-all"),a.$documentsDeselectAll=$(".uk-button-bulk-deselect"),a.documentsFolderOpen=!1,a.documentsIds=null,a.$documentsCheckboxes.length&&a.init()};DocumentsBulk.prototype.init=function(){var a=this,b=$.proxy(a.onCheckboxChange,a);a.$documentsCheckboxes.off("change",b),a.$documentsCheckboxes.on("change",b);var c=a.$actionsMenu.find(".uk-button-bulk-delete-documents"),d=$.proxy(a.onBulkDelete,a);c.off("click",d),c.on("click",d),a.$documentsFolderButton.on("click",$.proxy(a.documentsFolderButtonClick,a));var e=a.$actionsMenu.find(".uk-button-bulk-download-documents"),f=$.proxy(a.onBulkDownload,a);e.off("click",f),e.on("click",f);var g=$.proxy(a.onSelectAll,a),h=$.proxy(a.onDeselectAll,a);a.$documentsSelectAll.off("click",g),a.$documentsSelectAll.on("click",g),a.$documentsDeselectAll.off("click",h),a.$documentsDeselectAll.on("click",h)},DocumentsBulk.prototype.onSelectAll=function(a){var b=this;return b.$documentsCheckboxes.prop("checked",!0),b.onCheckboxChange(null),!1},DocumentsBulk.prototype.onDeselectAll=function(a){var b=this;return b.$documentsCheckboxes.prop("checked",!1),b.onCheckboxChange(null),!1},DocumentsBulk.prototype.onCheckboxChange=function(a){var b=this;b.documentsIds=[],$("input.document-checkbox:checked").each(function(a,c){b.documentsIds.push($(c).val())}),b.$documentsIdBulkFolders.length&&b.$documentsIdBulkFolders.val(b.documentsIds.join(",")),b.documentsIds.length>0?b.showActions():b.hideActions()},DocumentsBulk.prototype.onBulkDelete=function(a){var b=this;return b.documentsIds.length>0&&(history.pushState({headerData:{documents:b.documentsIds}},null,Rozier.routes.documentsBulkDeletePage),Rozier.lazyload.onPopState(null)),!1},DocumentsBulk.prototype.onBulkDownload=function(a){var b=this;return b.documentsIds.length>0&&(history.pushState({headerData:{documents:b.documentsIds}},null,Rozier.routes.documentsBulkDownloadPage),Rozier.lazyload.onPopState(null)),!1},DocumentsBulk.prototype.showActions=function(){var a=this;a.$actionsMenu.stop(),a.$actionsMenu.slideDown()},DocumentsBulk.prototype.hideActions=function(){var a=this;a.$actionsMenu.stop(),a.$actionsMenu.slideUp()},DocumentsBulk.prototype.documentsFolderButtonClick=function(a){var b=this;return b.documentsFolderOpen?(b.$documentsFolderCont.slideUp(),b.documentsFolderOpen=!1):(b.$documentsFolderCont.slideDown(),b.documentsFolderOpen=!0),!1};var NodesBulk=function(){var a=this;a.$nodesCheckboxes=$("input.node-checkbox"),a.$nodesIdBulkTags=$("input.nodes-id-bulk-tags"),a.$nodesIdBulkStatus=$("input.nodes-id-bulk-status"),a.$actionsMenu=$(".nodes-bulk-actions"),a.$nodesFolderButton=$(".uk-button-bulk-folder-nodes"),a.$nodesFolderCont=$(".nodes-bulk-folder-cont"),a.$nodesStatusButton=$(".uk-button-bulk-status-nodes"),a.$nodesStatusCont=$(".nodes-bulk-status-cont"),a.$nodesSelectAll=$(".uk-button-select-all"),a.$nodesDeselectAll=$(".uk-button-bulk-deselect"),a.nodesFolderOpen=!1,a.nodesStatusOpen=!1,a.nodesIds=null,a.$nodesCheckboxes.length&&a.init()};NodesBulk.prototype.init=function(){var a=this,b=$.proxy(a.onCheckboxChange,a);a.$nodesCheckboxes.off("change",b),a.$nodesCheckboxes.on("change",b),a.$nodesFolderButton.on("click",$.proxy(a.nodesFolderButtonClick,a)),a.$nodesStatusButton.on("click",$.proxy(a.nodesStatusButtonClick,a));var c=$.proxy(a.onSelectAll,a),d=$.proxy(a.onDeselectAll,a);a.$nodesSelectAll.off("click",c),a.$nodesSelectAll.on("click",c),a.$nodesDeselectAll.off("click",d),a.$nodesDeselectAll.on("click",d)},NodesBulk.prototype.onSelectAll=function(a){var b=this;return b.$nodesCheckboxes.prop("checked",!0),b.onCheckboxChange(null),!1},NodesBulk.prototype.onDeselectAll=function(a){var b=this;return b.$nodesCheckboxes.prop("checked",!1),b.onCheckboxChange(null),!1},NodesBulk.prototype.onCheckboxChange=function(a){var b=this;return b.nodesIds=[],$("input.node-checkbox:checked").each(function(a,c){b.nodesIds.push($(c).val())}),b.$nodesIdBulkTags.length&&b.$nodesIdBulkTags.val(b.nodesIds.join(",")),b.$nodesIdBulkStatus.length&&b.$nodesIdBulkStatus.val(b.nodesIds.join(",")),b.nodesIds.length>0?b.showActions():b.hideActions(),!1},NodesBulk.prototype.onBulkDelete=function(a){var b=this;return b.nodesIds.length>0&&(history.pushState({headerData:{nodes:b.nodesIds}},null,Rozier.routes.nodesBulkDeletePage),Rozier.lazyload.onPopState(null)),!1},NodesBulk.prototype.showActions=function(){this.$actionsMenu.slideDown()},NodesBulk.prototype.hideActions=function(){this.$actionsMenu.slideUp()},NodesBulk.prototype.nodesFolderButtonClick=function(a){var b=this;return b.nodesFolderOpen?(b.$nodesFolderCont.slideUp(),b.nodesFolderOpen=!1):(b.$nodesStatusCont.slideUp(),b.nodesStatusOpen=!1,b.$nodesFolderCont.slideDown(),b.nodesFolderOpen=!0),!1},NodesBulk.prototype.nodesStatusButtonClick=function(a){var b=this;return b.nodesStatusOpen?(b.$nodesStatusCont.slideUp(),b.nodesStatusOpen=!1):(b.$nodesFolderCont.slideUp(),b.nodesFolderOpen=!1,b.$nodesStatusCont.slideDown(),b.nodesStatusOpen=!0),!1};var TagsBulk=function(){var a=this;a.$tagsCheckboxes=$("input.tag-checkbox"),a.$tagsIdBulkTags=$("input.tags-id-bulk-tags"),a.$tagsIdBulkStatus=$("input.tags-id-bulk-status"),a.$actionsMenu=$(".tags-bulk-actions"),a.$tagsFolderButton=$(".uk-button-bulk-folder-tags"),a.$tagsFolderCont=$(".tags-bulk-folder-cont"),a.$tagsStatusButton=$(".uk-button-bulk-status-tags"),a.$tagsStatusCont=$(".tags-bulk-status-cont"),a.$tagsSelectAll=$(".uk-button-select-all"),a.$tagsDeselectAll=$(".uk-button-bulk-deselect"),a.tagsFolderOpen=!1,a.tagsStatusOpen=!1,a.tagsIds=null,a.$tagsCheckboxes.length&&a.init()};TagsBulk.prototype.init=function(){var a=this,b=$.proxy(a.onCheckboxChange,a);a.$tagsCheckboxes.off("change",b),a.$tagsCheckboxes.on("change",b),a.$tagsFolderButton.on("click",$.proxy(a.tagsFolderButtonClick,a)),a.$tagsStatusButton.on("click",$.proxy(a.tagsStatusButtonClick,a));var c=$.proxy(a.onSelectAll,a),d=$.proxy(a.onDeselectAll,a);a.$tagsSelectAll.off("click",c),a.$tagsSelectAll.on("click",c),a.$tagsDeselectAll.off("click",d),a.$tagsDeselectAll.on("click",d)},TagsBulk.prototype.onSelectAll=function(a){var b=this;return b.$tagsCheckboxes.prop("checked",!0),b.onCheckboxChange(null),!1},TagsBulk.prototype.onDeselectAll=function(a){var b=this;return b.$tagsCheckboxes.prop("checked",!1),b.onCheckboxChange(null),!1},TagsBulk.prototype.onCheckboxChange=function(a){var b=this;return b.tagsIds=[],$("input.tag-checkbox:checked").each(function(a,c){b.tagsIds.push($(c).val())}),b.$tagsIdBulkTags.length&&b.$tagsIdBulkTags.val(b.tagsIds.join(",")),b.$tagsIdBulkStatus.length&&b.$tagsIdBulkStatus.val(b.tagsIds.join(",")),b.tagsIds.length>0?b.showActions():b.hideActions(),!1},TagsBulk.prototype.onBulkDelete=function(a){var b=this;return b.tagsIds.length>0&&(history.pushState({headerData:{tags:b.tagsIds}},null,Rozier.routes.tagsBulkDeletePage),Rozier.lazyload.onPopState(null)),!1},TagsBulk.prototype.showActions=function(){this.$actionsMenu.slideDown()},TagsBulk.prototype.hideActions=function(){this.$actionsMenu.slideUp()},TagsBulk.prototype.tagsFolderButtonClick=function(a){var b=this;return b.tagsFolderOpen?(b.$tagsFolderCont.slideUp(),b.tagsFolderOpen=!1):(b.$tagsStatusCont.slideUp(),b.tagsStatusOpen=!1,b.$tagsFolderCont.slideDown(),b.tagsFolderOpen=!0),!1},TagsBulk.prototype.tagsStatusButtonClick=function(a){var b=this;return b.tagsStatusOpen?(b.$tagsStatusCont.slideUp(),b.tagsStatusOpen=!1):(b.$tagsFolderCont.slideUp(),b.tagsFolderOpen=!1,b.$tagsStatusCont.slideDown(),b.tagsStatusOpen=!0),!1},DocumentsList=function(){var a=this;a.$cont=$(".documents-list"),a.$cont.length&&(a.$item=a.$cont.find(".document-item")),a.contWidth=null,a.itemWidth=144,a.itemsPerLine=4,a.itemsWidth=576,a.contMarginLeft=0},DocumentsList.prototype.resize=function(){};var DocumentUploader=function(a){var b=this;b.options={onSuccess:function(a){},onError:function(a){},onAdded:function(a){},url:Rozier.routes.documentsUploadPage,selector:"#upload-dropzone-document",paramName:"form[attachment]",uploadMultiple:!1,maxFilesize:64,autoDiscover:!1,headers:{_token:Rozier.ajaxToken},dictDefaultMessage:"Drop files here to upload or click to open your explorer",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files."},void 0!==a&&$.extend(b.options,a),$(b.options.selector).length&&b.init()};DocumentUploader.prototype.init=function(){var a=this,b=$("#upload-dropzone-document");isset(b.attr("data-folder-id"))&&b.attr("data-folder-id")>0&&(a.options.headers.folderId=parseInt(b.attr("data-folder-id")),a.options.url=Rozier.routes.documentsUploadPage+"/"+parseInt(b.attr("data-folder-id"))),Dropzone.options.uploadDropzoneDocument={url:a.options.url,method:"post",headers:a.options.headers,paramName:a.options.paramName,uploadMultiple:a.options.uploadMultiple,maxFilesize:a.options.maxFilesize,dictDefaultMessage:a.options.dictDefaultMessage,dictFallbackMessage:a.options.dictFallbackMessage,dictFallbackText:a.options.dictFallbackText,dictFileTooBig:a.options.dictFileTooBig,dictInvalidFileType:a.options.dictInvalidFileType,dictResponseError:a.options.dictResponseError,dictCancelUpload:a.options.dictCancelUpload,dictCancelUploadConfirmation:a.options.dictCancelUploadConfirmation,dictRemoveFile:a.options.dictRemoveFile,dictRemoveFileConfirmation:a.options.dictRemoveFileConfirmation,dictMaxFilesExceeded:a.options.dictMaxFilesExceeded,init:function(){this.on("addedfile",function(b,c){a.options.onAdded(b)}),this.on("success",function(b,c){if(b.previewElement){var d=$(b.previewElement);setTimeout(function(){d.fadeOut(500,function(){d.remove()})},3e3)}a.options.onSuccess(c),Rozier.getMessages()}),this.on("canceled",function(b,c){a.options.onError(JSON.parse(c)),Rozier.getMessages()}),this.on("error",function(a,b,c){console.log(b)})}},Dropzone.autoDiscover=a.options.autoDiscover;new Dropzone(a.options.selector,Dropzone.options.uploadDropzoneDocument);$(a.options.selector).find(".dz-message").append('<div class="circles-icons"><div class="circle circle-1"></div><div class="circle circle-2"></div><div class="circle circle-3"></div><div class="circle circle-4"></div><div class="circle circle-5"></div><i class="uk-icon-rz-file"></i></div>')},NodeEditSource=function(){var a=this;a.$content=$(".content-node-edit-source").eq(0),a.$form=$("#edit-node-source-form"),a.$formRow=null,a.$dropdown=null,a.$input=null,a.$content.length&&(a.$formRow=a.$content.find(".uk-form-row"),a.wrapInTabs(),a.init(),a.initEvents())},NodeEditSource.prototype.wrapInTabs=function(){var a=this,b={},c=a.$content.find(".uk-form-row[data-field-group]"),d=c.length,e=0;if(d>1){for(var f=0;f<d;f++){var g=c[f].getAttribute("data-field-group");void 0===b[g]&&(b[g]=[],e++),b[g].push(c[f])}if(e>1){a.$form.append('<div id="node-source-form-switcher-nav-cont"><ul id="node-source-form-switcher-nav" class="uk-subnav uk-subnav-pill" data-uk-switcher="{connect:\'#node-source-form-switcher\', swiping:false}"></ul></div><ul id="node-source-form-switcher" class="uk-switcher"></ul>');var h=a.$form.find(".uk-switcher"),i=a.$form.find("#node-source-form-switcher-nav"),j=Object.keys(b).sort(function(a,b){return"default"==a?-1:"default"==b?1:+(a.toLowerCase()>b.toLowerCase())||+(a.toLowerCase()===b.toLowerCase())-1});for(var k in j){var l=j[k],m=l.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),n="group-"+m;h.append('<li class="field-group" id="'+n+'"></li>'),"default"==l?i.append('<li class="switcher-nav-item"><a href="#"><i class="uk-icon-star"></i></a></li>'):i.append('<li class="switcher-nav-item"><a href="#">'+l+"</a></li>");for(var o=h.find("#"+n),p=0;p<b[l].length;p++)o.append($(b[l][p]))}i.on("show.uk.switcher",function(a,b){Rozier.$window.trigger("resize")})}}},NodeEditSource.prototype.init=function(){var a=this;a.$input=a.$content.find("input, select"),a.$devNames=a.$content.find("[data-dev-name]");for(var b=a.$devNames.length-1;b>=0;b--){var c=a.$devNames[b],d=$(c);if(""!==c.getAttribute("data-dev-name")){var e=d.parents(".uk-form-row").find("label"),f=d.find(".uk-navbar-brand.label");e.length?e.append('<span class="field-dev-name">'+c.getAttribute("data-dev-name")+"</span>"):f.length&&f.append('<span class="field-dev-name">'+c.getAttribute("data-dev-name")+"</span>")}}for(var g=a.$formRow.length-1;g>=0;g--)if(a.$formRow[g].className.indexOf("children-nodes-widget")>=0){a.childrenNodeWidgetFlip(g);break}},NodeEditSource.prototype.initEvents=function(){var a=this;Rozier.$window.off("keydown",$.proxy(a.onInputKeyDown,a)),Rozier.$window.on("keydown",$.proxy(a.onInputKeyDown,a)),Rozier.$window.off("keyup",$.proxy(a.onInputKeyUp,a)),Rozier.$window.on("keyup",$.proxy(a.onInputKeyUp,a)),a.$input.off("focus",$.proxy(a.inputFocus,a)),a.$input.on("focus",$.proxy(a.inputFocus,a)),a.$input.off("focusout",$.proxy(a.inputFocusOut,a)),a.$input.on("focusout",$.proxy(a.inputFocusOut,a)),a.$form.off("submit"),a.$form.on("submit",$.proxy(a.onFormSubmit,a))},NodeEditSource.prototype.onFormSubmit=function(a){var b=this;return Rozier.lazyload.canvasLoader.show(),b.currentTimeout&&clearTimeout(b.currentTimeout),b.currentTimeout=setTimeout(function(){var a=new CustomEvent("pagechange");window.dispatchEvent(a);var c=new FormData(b.$form.get(0));$.ajax({url:window.location.href,type:"post",data:c,processData:!1,cache:!1,contentType:!1}).done(function(a){b.cleanErrors(),a.public_url&&($publicUrlLinks=$("a.public-url-link"),$publicUrlLinks.length&&$publicUrlLinks.attr("href",a.public_url))}).fail(function(a){b.displayErrors(a.responseJSON.errors),UIkit.notify({message:a.responseJSON.message,status:"danger",timeout:2e3,pos:"top-center"})}).always(function(){Rozier.lazyload.canvasLoader.hide(),Rozier.getMessages(),Rozier.refreshAllNodeTrees()})},300),!1},NodeEditSource.prototype.cleanErrors=function(){var a=$(".form-errored");a.each(function(b){a.eq(b).removeClass("form-errored"),a.eq(b).find(".error-message").remove()})},NodeEditSource.prototype.displayErrors=function(a,b){var c=this;b&&!1!==b||c.cleanErrors();for(var d in a){var e=null,f=null;"object"===toType(a[d])?c.displayErrors(a[d],!0):(e=d.replace("_","-"),f=a[d][0],$field=$(".form-col-"+e),$field.length&&($field.addClass("form-errored"),$field.append('<p class="error-message uk-alert uk-alert-danger"><i class="uk-icon uk-icon-warning"></i> '+f+"</p>")))}},NodeEditSource.prototype.onInputKeyDown=function(a){18==a.keyCode&&Rozier.$body.toggleClass("dev-name-visible")},NodeEditSource.prototype.onInputKeyUp=function(a){18==a.keyCode&&Rozier.$body.toggleClass("dev-name-visible")},NodeEditSource.prototype.childrenNodeWidgetFlip=function(a){var b=this;a>=b.$formRow.length-2&&(b.$dropdown=$(b.$formRow[a]).find(".uk-dropdown-small"),b.$dropdown.addClass("uk-dropdown-up"))},NodeEditSource.prototype.inputFocus=function(a){$(a.currentTarget).parent().addClass("form-col-focus")},NodeEditSource.prototype.inputFocusOut=function(a){$(a.currentTarget).parent().removeClass("form-col-focus")},NodeEditSource.prototype.resize=function(){};var SaveButtons=function(){var a=this;a.$button=$($(".rz-action-save").get(0)),a.$actionMenu=$($(".actions-menu").get(0)),a.bindKeyboard(),a.$button.length&&a.$actionMenu.length&&a.init()};SaveButtons.prototype.init=function(){var a=this,b=$(a.$button.attr("data-action-save"));b.length&&(a.$button.prependTo(a.$actionMenu),a.$button.on("click",function(a){b.submit()}),Mousetrap.bind(["mod+s"],function(a){return console.log("Save requested"),b.submit(),!1}))},SaveButtons.prototype.bindKeyboard=function(){Mousetrap.stopCallback=function(a,b,c){return!((" "+b.className+" ").indexOf(" mousetrap ")>-1)&&"SELECT"==b.tagName}},SettingsSaveButtons=function(){var a=this;a.$button=$(".uk-button-settings-save"),a.currentRequest=null,a.$button.length&&a.init()},SettingsSaveButtons.prototype.init=function(){var a=this;a.$button.off("click",$.proxy(a.buttonClick,a)),a.$button.on("click",$.proxy(a.buttonClick,a))},SettingsSaveButtons.prototype.buttonClick=function(a){var b=this;b.currentRequest&&4!=b.currentRequest.readyState&&b.currentRequest.abort();var c=$(a.currentTarget).parent().parent().find(".uk-form").eq(0);if(c.find("input[type=file]").length)return c.submit(),!1;Rozier.lazyload.canvasLoader.show();var d=new FormData(c[0]),e={url:window.location.href,type:"post",data:d,processData:!1,cache:!1,contentType:!1};return b.currentRequest=$.ajax(e).done(function(){console.log("Saved setting with success.")}).fail(function(){console.log("Error during save.")}).always(function(){Rozier.lazyload.canvasLoader.hide(),Rozier.getMessages()}),!1},SettingsSaveButtons.prototype.resize=function(){},NodeTree=function(){var a=this;a.$content=$(".content-node-tree"),a.$elements=null,a.$dropdown=null,a.$content.length&&(a.$dropdown=a.$content.find(".uk-dropdown-small"),a.init())},NodeTree.prototype.init=function(){var a=this;a.contentHeight=a.$content.actual("outerHeight"),a.contentHeight>=Rozier.windowHeight-400&&a.dropdownFlip()},NodeTree.prototype.dropdownFlip=function(){for(var a=this,b=a.$dropdown.length-1;b>=a.$dropdown.length-3;b--)addClass(a.$dropdown[b],"uk-dropdown-up")};var NodeStatuses=function(){var a=this;a.$containers=$(".node-statuses, .node-actions"),a.$icon=$(".node-status header i"),a.$inputs=a.$containers.find('input[type="checkbox"], input[type="radio"]'),a.$item=a.$containers.find(".node-statuses-item"),a.locked=!1,a.init()};NodeStatuses.prototype.init=function(){var a=this;a.$item.off("click",$.proxy(a.itemClick,a)),a.$item.on("click",$.proxy(a.itemClick,a)),a.$containers.on("mouseenter",$.proxy(a.containerEnter,a)),a.$containers.on("mouseleave",$.proxy(a.containerLeave,a)),a.$inputs.off("change",$.proxy(a.onChange,a)),a.$inputs.on("change",$.proxy(a.onChange,a)),a.$containers.find(".rz-boolean-checkbox").bootstrapSwitch({size:"small",onSwitchChange:$.proxy(a.onChange,a)})},NodeStatuses.prototype.containerEnter=function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.find("ul, nav").eq(0),d=b.height(),e=c.height(),f=b.offset().top;window.innerHeight<f+e+d&&b.addClass("reverse")},NodeStatuses.prototype.containerLeave=function(a){a.stopPropagation(),$(a.currentTarget).removeClass("reverse")},NodeStatuses.prototype.itemClick=function(a){a.stopPropagation(),$input=$(a.currentTarget).find('input[type="radio"]'),$input.length&&($input.prop("checked",!0),$input.trigger("change"))},NodeStatuses.prototype.onChange=function(a){var b=this;if(a.stopPropagation(),!1===b.locked){b.locked=!0;var c=$(a.currentTarget);if(c.length){var d=c.attr("name"),e=null;c.is('input[type="checkbox"]')?e=Number(c.is(":checked")):c.is('input[type="radio"]')&&(b.$icon[0].className=c.parent().find("i")[0].className,e=Number(c.val()));var f={_token:Rozier.ajaxToken,_action:"nodeChangeStatus",nodeId:parseInt(c.attr("data-node-id")),statusName:d,statusValue:e};console.log(f),$.ajax({url:Rozier.routes.nodesStatusesAjax,type:"post",dataType:"json",cache:!1,data:f}).done(function(a){Rozier.refreshMainNodeTree(),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){a=JSON.parse(a.responseText),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(a){b.locked=!1})}}};var GeotagField=function(){var a=this;a.$fields=$("input.rz-geotag-field"),a.geocoder=null,a.$fields.length&&""!==Rozier.googleClientId&&a.init()};GeotagField.prototype.init=function(){var a=this;if(Rozier.gMapLoaded||Rozier.gMapLoading)Rozier.gMapLoaded&&!Rozier.gMapLoading&&a.bindFields();else{Rozier.gMapLoading=!0;var b=document.createElement("script");b.type="text/javascript",b.src="//maps.googleapis.com/maps/api/js?key="+Rozier.googleClientId+"&callback=initializeGeotagFields",document.body.appendChild(b)}},GeotagField.prototype.bindFields=function(){var a=this;a.geocoder=new google.maps.Geocoder,a.$fields.each(function(b,c){a.bindSingleField(c)})},GeotagField.prototype.bindSingleField=function(a){var b=this,c=$(a),d=c.parent().find(".uk-form-label"),e=d[0].innerHTML,f=null;f=Rozier.defaultMapLocation?Rozier.defaultMapLocation:{lat:45.769785,lng:4.833967,zoom:14};var g="geotag-canvas-"+GeotagField.uniqid(),h=g+"-address",i=g+"-reset",j={center:new google.maps.LatLng(f.lat,f.lng),zoom:f.zoom,scrollwheel:!1,styles:Rozier.mapsStyle};c.hide(),d.hide(),c.attr("data-geotag-canvas",g),c.after('<div class="rz-geotag-canvas" id="'+g+'" style="width: 100%; height: 400px;"></div>');var k=['<nav class="geotag-widget-nav uk-navbar rz-geotag-meta">','<ul class="uk-navbar-nav">','<li class="uk-navbar-brand"><i class="uk-icon-rz-map-marker"></i>','<li class="uk-navbar-brand label">'+e+"</li>","</ul>",'<div class="uk-navbar-content uk-navbar-flip">','<div class="geotag-widget-quick-creation uk-button-group">','<input class="rz-geotag-address" id="'+h+'" type="text" value="" />','<a id="'+i+'" class="uk-button uk-button-content uk-button-table-delete rz-geotag-reset" title="'+Rozier.messages.geotag.resetMarker+'" data-uk-tooltip="{animation:true}"><i class="uk-icon-rz-trash-o"></i></a>',"</div>","</div>","</nav>"].join("");c.after(k);var l=$("#"+h);l.attr("placeholder",Rozier.messages.geotag.typeAnAddress);var m=$("#"+i);m.hide();var n=new google.maps.Map(document.getElementById(g),j),o=null;if(""!==c.val())try{f=JSON.parse(c.val()),o=b.createMarker(f,c,n),m.show()}catch(p){return c.show(),$(document.getElementById(g)).hide(),!1}else o=new google.maps.Marker({draggable:!0,position:j.center,animation:google.maps.Animation.DROP,icon:Rozier.resourcesUrl+"img/map_marker.png"});google.maps.event.addListener(o,"dragend",$.proxy(b.setMarkerEvent,b,o,c,m,n)),google.maps.event.addListener(n,"click",$.proxy(b.setMarkerEvent,b,o,c,m,n)),l.on("keypress",$.proxy(b.requestGeocode,b,o,c,m,n)),m.on("click",$.proxy(b.resetMarker,b,o,c,m,n)),Rozier.$window.on("resize",$.proxy(b.resetMap,this,n,o,j)),b.resetMap(n,o,j,null)},GeotagField.prototype.resetMap=function(a,b,c,d){setTimeout(function(){google.maps.event.trigger(a,"resize"),null!==b?a.panTo(b.getPosition()):a.panTo(c.center)},300)},GeotagField.prototype.resetMarker=function(a,b,c,d,e){return a.setMap(null),b.val(""),c.hide(),!1},GeotagField.prototype.setMarkerEvent=function(a,b,c,d,e){this.setMarker(a,b,c,d,e.latLng)},GeotagField.prototype.setMarker=function(a,b,c,d,e){a.setPosition(e),a.setMap(d),d.panTo(e);var f={lat:e.lat(),lng:e.lng(),zoom:d.getZoom()};b.val(JSON.stringify(f)),c.show()},GeotagField.prototype.createMarker=function(a,b,c){var d=new google.maps.LatLng(a.lat,a.lng),e=new google.maps.Marker({map:c,draggable:!0,animation:google.maps.Animation.DROP,position:d,icon:Rozier.resourcesUrl+"img/map_marker.png"});return c.panTo(d),c.setZoom(a.zoom),e.zoom=a.zoom,void 0!==a.name&&(e.name=a.name),e},GeotagField.prototype.requestGeocode=function(a,b,c,d,e){var f=this,g=e.currentTarget.value;if(13==e.which)return e.preventDefault(),f.geocoder.geocode({address:g},function(e,g){g==google.maps.GeocoderStatus.OK?f.setMarker(a,b,c,d,e[0].geometry.location):console.err("Geocode was not successful for the following reason: "+g)}),!1};var initializeGeotagFields=function(){Rozier.gMapLoaded=!0,Rozier.gMapLoading=!1,new GeotagField,new MultiGeotagField};GeotagField.uniqid=function(){return(new Date).getTime()};var MultiGeotagField=function(){var a=this;a.$fields=$(".rz-multi-geotag-field"),a.geocoder=null,a.$fields.length&&""!==Rozier.googleClientId&&a.init()};$.extend(MultiGeotagField.prototype,GeotagField.prototype),MultiGeotagField.prototype.resetMarker=function(a,b,c,d,e,f){var g=this;b.val("");for(var h=a.length-1;h>=0;h--)a[h].setMap(null),a[h]=null;return a=[],c.hide(),g.syncSelector(e,a,d,b),!1},MultiGeotagField.prototype.bindSingleField=function(a){var b=this,c=$(a),d=c.parent().find(".uk-form-label"),e=d[0].innerHTML,f={lat:45.769785,lng:4.833967,zoom:14},g="geotag-canvas-"+GeotagField.uniqid(),h=g+"-address",i=g+"-reset",j={center:new google.maps.LatLng(f.lat,f.lng),zoom:f.zoom,scrollwheel:!1,styles:Rozier.mapsStyle};c.hide(),d.hide(),c.attr("data-geotag-canvas",g);var k=['<nav class="geotag-widget-nav uk-navbar rz-geotag-meta">','<ul class="uk-navbar-nav">','<li class="uk-navbar-brand"><i class="uk-icon-rz-map-multi-marker"></i>','<li class="uk-navbar-brand label">'+e+"</li>","</ul>",'<div class="uk-navbar-content uk-navbar-flip">','<div class="geotag-widget-quick-creation uk-button-group">','<input class="rz-geotag-address" id="'+h+'" type="text" value="" />','<a id="'+i+'" class="uk-button uk-button-content uk-button-table-delete rz-geotag-reset" title="'+Rozier.messages.geotag.resetMarker+'" data-uk-tooltip="{animation:true}"><i class="uk-icon-rz-trash-o"></i></a>',"</div>","</div>","</nav>",'<div class="multi-geotag-group">','<ul class="multi-geotag-list-markers">',"</ul>",'<div class="rz-geotag-canvas" id="'+g+'"></div>',"</div>"].join("");c.after(k);var l=$("#"+h);l.attr("placeholder",Rozier.messages.geotag.typeAnAddress);var m=$("#"+i);m.hide();var n=new google.maps.Map(document.getElementById(g),j),o=[],p=c.parent().find(".multi-geotag-list-markers");if(""!==c.val())try{for(var q=JSON.parse(c.val()),r=q.length,s=0;s<r;s++)o[s]=b.createMarker(q[s],c,n),google.maps.event.addListener(o[s],"dragend",$.proxy(b.setMarkerEvent,b,o[s],o,c,m,n));m.show()}catch(t){return c.show(),$(document.getElementById(g)).hide(),!1}google.maps.event.addListener(n,"click",$.proxy(b.setMarkerEvent,b,null,o,c,m,n)),google.maps.event.addListener(n,"click",$.proxy(b.syncSelector,b,p,o,n,c)),l.on("keypress",$.proxy(b.requestGeocode,b,o,c,m,n,p)),m.on("click",$.proxy(b.resetMarker,b,o,c,m,n,p)),m.on("click",$.proxy(b.syncSelector,b,p,o,n,c)),Rozier.$window.on("resize",$.proxy(b.resetMap,b,n,o,j)),b.resetMap(n,o,j,null),b.syncSelector(p,o,n,c)},
MultiGeotagField.prototype.syncSelector=function(a,b,c,d){var e=this;a.empty();for(var f=b.length,g=0;g<f;g++)if(null!==b[g]){var h=e.getGeocodeFromMarker(b[g]);a.append(["<li>",'<span class="multi-geotag-marker-name">',h.name?h.name:"#"+g,"</span>",'<a class="button rz-multi-geotag-center" data-geocode-id="'+g+'" data-geocode="'+JSON.stringify(h)+'"><i class="uk-icon-rz-marker"></i></a>','<a class="button rz-multi-geotag-remove" data-geocode-id="'+g+'"><i class="uk-icon-rz-trash-o"></i></a>',"</li>"].join(""));var i=a.find('.rz-multi-geotag-center[data-geocode-id="'+g+'"]'),j=a.find('.rz-multi-geotag-remove[data-geocode-id="'+g+'"]');i.on("click",$.proxy(e.centerMap,e,c,b[g])),j.on("click",$.proxy(e.removeMarker,e,c,b,g,a,d))}},MultiGeotagField.prototype.removeMarker=function(a,b,c,d,e,f){var g=this;return b[c].setMap(null),b[c]=null,g.syncSelector(d,b,a,e),g.writeMarkers(b,e),!1},MultiGeotagField.prototype.getGeocodeFromMarker=function(a){return{lat:a.getPosition().lat(),lng:a.getPosition().lng(),zoom:a.zoom,name:a.name}},MultiGeotagField.prototype.resetMap=function(a,b,c,d){var e=this;setTimeout(function(){google.maps.event.trigger(a,"resize"),void 0!==b&&b.length>0?a.fitBounds(e.getMediumLatLng(b)):a.panTo(c.center)},300)},MultiGeotagField.prototype.centerMap=function(a,b,c){return setTimeout(function(){google.maps.event.trigger(a,"resize"),void 0!==b&&a.panTo(b.getPosition()),void 0!==b.zoom&&a.setZoom(b.zoom)},300),!1},MultiGeotagField.prototype.getMediumLatLng=function(a){var b=new google.maps.LatLngBounds;for(var c in a){a[c];b.extend(a[c].getPosition())}return b},MultiGeotagField.prototype.setMarkerEvent=function(a,b,c,d,e,f){this.setMarker(a,b,c,d,e,f.latLng)},MultiGeotagField.prototype.setMarker=function(a,b,c,d,e,f,g){var h=this;null===a&&(a=new google.maps.Marker({map:e,draggable:!0,animation:google.maps.Animation.DROP,position:f,icon:Rozier.resourcesUrl+"img/map_marker.png"})),a.setPosition(f),a.setMap(e),a.zoom=e.getZoom(),a.name=g,e.panTo(f);f.lat(),f.lng(),e.getZoom();return b.push(a),h.writeMarkers(b,c),d.show(),a},MultiGeotagField.prototype.writeMarkers=function(a,b){for(var c=this,d=[],e=a.length-1;e>=0;e--)null!==a[e]&&d.push(c.getGeocodeFromMarker(a[e]));b.val(JSON.stringify(d))},MultiGeotagField.prototype.requestGeocode=function(a,b,c,d,e,f){var g=this,h=f.currentTarget.value;if(13==f.which)return f.preventDefault(),g.geocoder.geocode({address:h},function(f,i){i==google.maps.GeocoderStatus.OK?(g.setMarker(null,a,b,c,d,f[0].geometry.location,h),g.syncSelector(e,a,d,b)):console.err("Geocode was not successful for the following reason: "+i)}),!1};var ChildrenNodesField=function(){var a=this;a.currentRequest=null,a.init()};ChildrenNodesField.prototype.init=function(){var a=this;if(a.$fields=$("[data-children-nodes-widget]"),a.$nodeTrees=a.$fields.find(".nodetree-widget"),a.$quickAddNodeButtons=a.$fields.find(".children-nodes-quick-creation a"),a.$quickAddNodeButtons.length){var b=$.proxy(a.onQuickAddClick,a);a.$quickAddNodeButtons.off("click",b),a.$quickAddNodeButtons.on("click",b)}a.$fields.find(".nodetree-langs").remove()},ChildrenNodesField.prototype.treeAvailable=function(){return!!this.$fields.find(".nodetree-widget").length},ChildrenNodesField.prototype.onQuickAddClick=function(a){var b=this;return b.ajaxTimeout&&clearTimeout(b.ajaxTimeout),b.ajaxTimeout=window.setTimeout(function(){var c=$(a.currentTarget),d=parseInt(c.attr("data-children-node-type")),e=parseInt(c.attr("data-children-parent-node")),f=parseInt(c.attr("data-translation-id"));if(d>0&&e>0){var g={_token:Rozier.ajaxToken,_action:"quickAddNode",nodeTypeId:d,parentNodeId:e,translationId:f};$.ajax({url:Rozier.routes.nodesQuickAddAjax,type:"post",dataType:"json",data:g}).done(function(a){Rozier.refreshMainNodeTree();var d=c.parents(".children-nodes-widget").find(".nodetree-widget");b.refreshNodeTree(d,e,f),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log("error"),console.log(a),a=JSON.parse(a.responseText),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){})}},200),!1},ChildrenNodesField.prototype.refreshNodeTree=function(a,b,c){var d=this;if(a.length){if(d.currentRequest&&4!=d.currentRequest.readyState&&d.currentRequest.abort(),void 0===b){var e=$(a.find(".root-tree")[0]);b=parseInt(e.attr("data-parent-node-id")),c=parseInt(e.attr("data-translation-id"))}Rozier.lazyload.canvasLoader.show();var f={_token:Rozier.ajaxToken,_action:"requestNodeTree",parentNodeId:parseInt(b)},g=Rozier.routes.nodesTreeAjax;isset(c)&&c>0&&(g+="/"+c),d.currentRequest=$.ajax({url:g,type:"get",dataType:"json",cache:!1,data:f}).done(function(b){a.length&&void 0!==b.nodeTree&&a.fadeOut("slow",function(){var c=a.parents(".children-nodes-widget");a.replaceWith(b.nodeTree),a=c.find(".nodetree-widget"),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.lazyload.bindAjaxLink(),a.fadeIn(),d.init(),Rozier.lazyload.canvasLoader.hide(),Rozier.lazyload.nodeTreeContextActions=new NodeTreeContextActions})}).fail(function(a){console.log(a.responseJSON)})}else console.error("No node-tree available.")},MarkdownEditor=function(a,b){var c=this;c.markdownit=window.markdownit(),c.markdownit.use(window.markdownitFootnote),c.$textarea=a,c.textarea=c.$textarea[0],c.usePreview=!1,c.editor=CodeMirror.fromTextArea(c.textarea,{mode:"gfm",lineNumbers:!1,tabSize:4,styleActiveLine:!0,indentWithTabs:!1,lineWrapping:!0,viewportMargin:1/0,enterMode:"keep"}),c.editor.addKeyMap({"Ctrl-B":function(a){a.replaceSelections(c.boldSelections())},"Ctrl-I":function(a){a.replaceSelections(c.italicSelections())},"Cmd-B":function(a){a.replaceSelections(c.boldSelections())},"Cmd-I":function(a){a.replaceSelections(c.italicSelections())}}),c.$cont=c.$textarea.parents(".uk-form-row").eq(0),c.index=b,c.$buttonCode=null,c.$buttonPreview=null,c.$buttonFullscreen=null,c.$count=null,c.$countCurrent=null,c.limit=0,c.countMinLimit=0,c.countMaxLimit=0,c.$countMaxLimitText=null,c.countAlertActive=!1,c.fullscreenActive=!1,c.$parentForm=c.$textarea.parents("form").eq(0),c.closePreviewProxy=$.proxy(c.closePreview,c),c.init()},MarkdownEditor.prototype.init=function(){var a=this;if(a.editor.on("change",$.proxy(a.textareaChange,a)),a.$cont.length&&a.$textarea.length){a.$editor=a.$cont.find(".CodeMirror").eq(0),a.$cont.addClass("markdown-editor"),a.$buttons=a.$cont.find("[data-markdowneditor-button]"),a.$content=a.$cont.find(".markdown-editor-content"),a.$buttonCode=a.$cont.find(".markdown-editor-button-code"),a.$buttonPreview=a.$cont.find(".markdown-editor-button-preview"),a.$buttonFullscreen=a.$cont.find(".markdown-editor-button-fullscreen"),a.$count=a.$cont.find(".markdown-editor-count"),a.$countCurrent=a.$cont.find(".count-current"),a.$countMaxLimitText=a.$cont.find(".count-limit"),a.$cont.find(".markdown-editor-button-code").attr("data-index",a.index),a.$cont.find(".markdown-editor-button-preview").attr("data-index",a.index),a.$cont.find(".markdown-editor-button-fullscreen").attr("data-index",a.index),a.$cont.find(".markdown_textarea").attr("data-index",a.index),a.$editor.attr("data-index",a.index),a.$editor.before('<div class="markdown-editor-tabs">'),a.$tabs=a.$cont.find(".markdown-editor-tabs").eq(0),a.$editor.after('<div class="markdown-editor-preview">'),a.$preview=a.$cont.find(".markdown-editor-preview").eq(0),a.$tabs.append(a.$editor),a.$tabs.append(a.$preview),a.editor.refresh(),a.textarea.hasAttribute("data-max-length")&&""!==a.textarea.getAttribute("data-max-length")&&(a.limit=!0,a.countMaxLimit=parseInt(a.textarea.getAttribute("data-max-length")),a.$countCurrent.length&&a.$countMaxLimitText.length&&a.$count.length&&(a.$countCurrent[0].innerHTML=stripTags(a.editor.getValue()).length,a.$countMaxLimitText[0].innerHTML=a.textarea.getAttribute("data-max-length"),a.$count[0].style.display="block")),a.textarea.hasAttribute("data-min-length")&&""!==a.textarea.getAttribute("data-min-length")&&(a.limit=!0,a.countMinLimit=parseInt(a.textarea.getAttribute("data-min-length"))),a.textarea.hasAttribute("data-max-length")&&a.textarea.hasAttribute("data-min-length")&&""===a.textarea.getAttribute("data-min-length")&&""===a.textarea.getAttribute("data-max-length")&&(a.limit=!1,a.countMaxLimit=null,a.countAlertActive=null),a.fullscreenActive=!1,a.limit&&(stripTags(a.editor.getValue()).length>a.countMaxLimit?(a.countAlertActive=!0,addClass(a.$cont[0],"content-limit")):stripTags(a.editor.getValue()).length<a.countMinLimit?(a.countAlertActive=!0,addClass(a.$cont[0],"content-limit")):a.countAlertActive=!1),a.editor.on("change",$.proxy(a.textareaChange,a)),a.editor.on("focus",$.proxy(a.textareaFocus,a)),a.editor.on("blur",$.proxy(a.textareaBlur,a)),a.editor.on("drop",$.proxy(a.onDropFile,a)),a.$buttonPreview.on("click",$.proxy(a.buttonPreviewClick,a)),a.$buttons.on("click",$.proxy(a.buttonClick,a)),Rozier.$window.on("keyup",$.proxy(a.echapKey,a));var b=$.proxy(a.forceEditorUpdate,a);setTimeout(function(){$("[data-uk-switcher]").on("show.uk.switcher",b),a.forceEditorUpdate()},300)}},MarkdownEditor.prototype.onDropFile=function(a,b){var c=this;b.preventDefault(b);for(var d=0;d<b.dataTransfer.files.length;d++){Rozier.lazyload.canvasLoader.show();var e=b.dataTransfer.files[d],f=new FormData;f.append("_token",Rozier.ajaxToken),f.append("form[attachment]",e),$.ajax({url:Rozier.routes.documentsUploadPage,type:"post",dataType:"json",cache:!1,data:f,processData:!1,contentType:!1}).always($.proxy(c.onDropFileUploaded,c,a))}},MarkdownEditor.prototype.onDropFileUploaded=function(a,b){if(Rozier.lazyload.canvasLoader.hide(),b.success===!0){var c="!["+b.thumbnail.filename+"]("+b.thumbnail.large+")";a.replaceSelection(c)}},MarkdownEditor.prototype.forceEditorUpdate=function(a){var b=this;b.editor.refresh(),b.usePreview&&b.$preview.html(b.markdownit.render(b.editor.getValue()))},MarkdownEditor.prototype.buttonClick=function(a){var b=this,c=$(a.currentTarget),d=b.editor.getSelections();if(d.length>0){switch(c.attr("data-markdowneditor-button")){case"nbsp":b.editor.replaceSelections(b.nbspSelections(d));break;case"listUl":b.editor.replaceSelections(b.listUlSelections(d));break;case"link":b.editor.replaceSelections(b.linkSelections(d));break;case"image":b.editor.replaceSelections(b.imageSelections(d));break;case"bold":b.editor.replaceSelections(b.boldSelections(d));break;case"italic":b.editor.replaceSelections(b.italicSelections(d));break;case"blockquote":b.editor.replaceSelections(b.blockquoteSelections(d));break;case"h2":b.editor.replaceSelections(b.h2Selections(d));break;case"h3":b.editor.replaceSelections(b.h3Selections(d));break;case"h4":b.editor.replaceSelections(b.h4Selections(d));break;case"h5":b.editor.replaceSelections(b.h5Selections(d));break;case"h6":b.editor.replaceSelections(b.h6Selections(d));break;case"back":b.editor.replaceSelections(b.backSelections(d));break;case"hr":b.editor.replaceSelections(b.hrSelections(d))}b.editor.focus()}},MarkdownEditor.prototype.backSelections=function(a){for(var b in a)a[b]="   \n";return a},MarkdownEditor.prototype.hrSelections=function(a){for(var b in a)a[b]="\n\n---\n\n";return a},MarkdownEditor.prototype.nbspSelections=function(a){for(var b in a)a[b]=" ";return a},MarkdownEditor.prototype.listUlSelections=function(a){for(var b in a)a[b]="\n\n* "+a[b]+"\n\n";return a},MarkdownEditor.prototype.linkSelections=function(a){for(var b in a)a[b]="["+a[b]+"](http://)";return a},MarkdownEditor.prototype.imageSelections=function(a){var b=this;a||(a=b.editor.getSelections());for(var c in a)a[c]="!["+a[c]+"](/files/)";return a},MarkdownEditor.prototype.boldSelections=function(a){var b=this;a||(a=b.editor.getSelections());for(var c in a)a[c]="**"+a[c]+"**";return a},MarkdownEditor.prototype.italicSelections=function(a){var b=this;a||(a=b.editor.getSelections());for(var c in a)a[c]="*"+a[c]+"*";return a},MarkdownEditor.prototype.h2Selections=function(a){for(var b in a)a[b]="\n## "+a[b]+"\n";return a},MarkdownEditor.prototype.h3Selections=function(a){for(var b in a)a[b]="\n### "+a[b]+"\n";return a},MarkdownEditor.prototype.h4Selections=function(a){for(var b in a)a[b]="\n#### "+a[b]+"\n";return a},MarkdownEditor.prototype.h5Selections=function(a){for(var b in a)a[b]="\n##### "+a[b]+"\n";return a},MarkdownEditor.prototype.h6Selections=function(a){for(var b in a)a[b]="\n###### "+a[b]+"\n";return a},MarkdownEditor.prototype.blockquoteSelections=function(a){for(var b in a)a[b]="\n> "+a[b]+"\n";return a},MarkdownEditor.prototype.textareaChange=function(a){var b=this;b.editor.save(),b.usePreview&&(clearTimeout(b.refreshPreviewTimeout),b.refreshPreviewTimeout=setTimeout(function(){b.$preview.html(b.markdownit.render(b.editor.getValue()))},100)),b.limit&&setTimeout(function(){var a=b.editor.getValue(),c=stripTags(a),d=c.length;b.$countCurrent.html(d),d>b.countMaxLimit?b.countAlertActive||(b.$cont.addClass("content-limit"),b.countAlertActive=!0):d<b.countMinLimit?b.countAlertActive||(b.$cont.addClass("content-limit"),b.countAlertActive=!0):b.countAlertActive&&(b.$cont.removeClass("content-limit"),b.countAlertActive=!1)},100)},MarkdownEditor.prototype.textareaFocus=function(a){this.$cont.addClass("form-col-focus")},MarkdownEditor.prototype.textareaBlur=function(a){this.$cont.removeClass("form-col-focus")},MarkdownEditor.prototype.buttonPreviewClick=function(a){var b=this;a.preventDefault();var c=b.$preview.outerWidth();if(b.usePreview)b.closePreview();else{b.usePreview=!0,b.$buttonPreview.addClass("uk-active active"),b.$preview.addClass("active"),b.forceEditorUpdate(),TweenLite.fromTo(b.$preview,1,{x:c*-1,opacity:0},{x:0,ease:Expo.easeOut,opacity:1}),Rozier.$window.on("keyup",b.closePreviewProxy);var d=new CustomEvent("markdownPreviewOpen",{detail:this});document.body.dispatchEvent(d)}},MarkdownEditor.prototype.closePreview=function(a){var b=this;if(a){if(27!=a.keyCode)return;a.preventDefault()}var c=b.$preview.outerWidth();Rozier.$window.off("keyup",b.closePreviewProxy),b.usePreview=!1,b.$buttonPreview.removeClass("uk-active active"),TweenLite.fromTo(b.$preview,1,{x:0,opacity:1},{x:c*-1,opacity:0,ease:Expo.easeOut,onComplete:function(){b.$preview.removeClass("active")}})},MarkdownEditor.prototype.resize=function(){},JsonEditor=function(a,b){var c=this;c.$textarea=a,c.textarea=c.$textarea[0],c.$cont=c.$textarea.parents(".uk-form-row").eq(0),c.$settingRow=c.$textarea.parents(".setting-row").eq(0);var d={lineNumbers:!0,mode:{name:"javascript",json:!0},theme:"mbo",tabSize:2,lineWrapping:!0,dragDrop:!1};c.$settingRow.length&&(d.lineNumbers=!1),c.editor=CodeMirror.fromTextArea(c.textarea,d),c.init()},JsonEditor.prototype.init=function(){var a=this;if(a.$textarea.length){a.editor.on("change",$.proxy(a.textareaChange,a)),a.editor.on("focus",$.proxy(a.textareaFocus,a)),a.editor.on("blur",$.proxy(a.textareaBlur,a));var b=$.proxy(a.forceEditorUpdate,a);setTimeout(function(){$("[data-uk-switcher]").on("show.uk.switcher",b),a.forceEditorUpdate()},300)}},JsonEditor.prototype.forceEditorUpdate=function(a){this.editor.refresh()},JsonEditor.prototype.textareaChange=function(a){var b=this;b.editor.save(),b.limit&&setTimeout(function(){var a=b.editor.getValue(),c=stripTags(a);c.length},100)},JsonEditor.prototype.textareaFocus=function(a){this.$cont.addClass("form-col-focus")},JsonEditor.prototype.textareaBlur=function(a){this.$cont.removeClass("form-col-focus")},JsonEditor.prototype.resize=function(){},CssEditor=function(a,b){var c=this;c.$textarea=a,c.textarea=c.$textarea[0],c.$cont=c.$textarea.parents(".uk-form-row").eq(0),c.$settingRow=c.$textarea.parents(".setting-row").eq(0);var d={lineNumbers:!0,mode:"css",theme:"mbo",tabSize:2,lineWrapping:!0,dragDrop:!1};c.$settingRow.length&&(d.lineNumbers=!1),c.editor=CodeMirror.fromTextArea(c.textarea,d),c.init()},CssEditor.prototype.init=function(){var a=this;if(a.$textarea.length){a.editor.on("change",$.proxy(a.textareaChange,a)),a.editor.on("focus",$.proxy(a.textareaFocus,a)),a.editor.on("blur",$.proxy(a.textareaBlur,a));var b=$.proxy(a.forceEditorUpdate,a);setTimeout(function(){$("[data-uk-switcher]").on("show.uk.switcher",b),a.forceEditorUpdate()},300)}},CssEditor.prototype.forceEditorUpdate=function(a){this.editor.refresh()},CssEditor.prototype.textareaChange=function(a){var b=this;b.editor.save(),b.limit&&setTimeout(function(){var a=b.editor.getValue(),c=stripTags(a);c.length},100)},CssEditor.prototype.textareaFocus=function(a){this.$cont.addClass("form-col-focus")},CssEditor.prototype.textareaBlur=function(a){this.$cont.removeClass("form-col-focus")},CssEditor.prototype.resize=function(){},YamlEditor=function(a,b){var c=this;c.$textarea=a,c.textarea=c.$textarea[0],c.$cont=c.$textarea.parents(".uk-form-row").eq(0),c.$settingRow=c.$textarea.parents(".setting-row").eq(0);var d={lineNumbers:!0,mode:"yaml",theme:"mbo",tabSize:2,lineWrapping:!0,dragDrop:!1};c.$settingRow.length&&(d.lineNumbers=!1),c.editor=CodeMirror.fromTextArea(c.textarea,d),c.init()},YamlEditor.prototype.init=function(){var a=this;if(a.$textarea.length){a.editor.on("change",$.proxy(a.textareaChange,a)),a.editor.on("focus",$.proxy(a.textareaFocus,a)),a.editor.on("blur",$.proxy(a.textareaBlur,a));var b=$.proxy(a.forceEditorUpdate,a);setTimeout(function(){$("[data-uk-switcher]").on("show.uk.switcher",b),a.forceEditorUpdate()},300)}},YamlEditor.prototype.forceEditorUpdate=function(a){this.editor.refresh()},YamlEditor.prototype.textareaChange=function(a){var b=this;b.editor.save(),b.limit&&setTimeout(function(){var a=b.editor.getValue(),c=stripTags(a);c.length},100)},YamlEditor.prototype.textareaFocus=function(a){this.$cont.addClass("form-col-focus")},YamlEditor.prototype.textareaBlur=function(a){this.$cont.removeClass("form-col-focus")},YamlEditor.prototype.resize=function(){};var TagAutocomplete=function(){function a(a){return a.split(/,\s*/)}function b(b){return a(b).pop()}function c(){d.$input.tagEditor({autocomplete:{delay:.3,position:{collision:"flip"},source:function(a,c){$.getJSON(Rozier.routes.tagAjaxSearch,{_action:"tagAutocomplete",_token:Rozier.ajaxToken,search:b(a.term)},c)}},placeholder:d.placeholder,initialTags:d.initialTags,animateDelete:0})}var d=this;d.$input=$(".rz-tag-autocomplete").eq(0),d.initialUrl=d.$input.attr("data-get-url"),d.placeholder=d.$input.attr("placeholder"),d.initialTags=[],void 0!==d.initialUrl&&""!==d.initialUrl?$.getJSON(d.initialUrl,{_action:"getNodeTags",_token:Rozier.ajaxToken},function(a){d.initialTags=a,c()}):c()},FolderAutocomplete=function(){function a(a){return a.split(/,\s*/)}function b(b){return a(b).pop()}$(".rz-folder-autocomplete").bind("keydown",function(a){a.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&a.preventDefault()}).autocomplete({source:function(a,c){$.getJSON(Rozier.routes.foldersAjaxSearch,{_action:"folderAutocomplete",_token:Rozier.ajaxToken,search:b(a.term)},c)},search:function(){if(b(this.value).length<2)return!1},focus:function(){return!1},select:function(b,c){var d=a(this.value);return d.pop(),d.push(c.item.value),d.push(""),this.value=d.join(", "),!1}})};InputLengthWatcher=function(){var a=this;if(a.$maxLengthed=$("input[data-max-length]"),a.$minLengthed=$("input[data-min-length]"),a.$maxLengthed.length){var b=$.proxy(a.onMaxKeyUp,a);a.$maxLengthed.off("keyup",b),a.$maxLengthed.on("keyup",b)}if(a.$minLengthed.length){var c=$.proxy(a.onMinKeyUp,a);a.$minLengthed.off("keyup",c),a.$minLengthed.on("keyup",c)}},InputLengthWatcher.prototype.onMaxKeyUp=function(a){var b=$(a.currentTarget),c=Math.round(a.currentTarget.getAttribute("data-max-length"));a.currentTarget.value.length>c?b.addClass("uk-form-danger"):b.removeClass("uk-form-danger")},InputLengthWatcher.prototype.onMinKeyUp=function(a){var b=$(a.currentTarget),c=Math.round(a.currentTarget.getAttribute("data-min-length"));a.currentTarget.value.length<=c?b.addClass("uk-form-danger"):b.removeClass("uk-form-danger")};var StackNodeTree=function(){var a=this;a.$page=$(".stack-tree").eq(0),a.currentRequest=null,a.$quickAddNodeButtons=a.$page.find(".stack-tree-quick-creation a"),a.$switchLangButtons=a.$page.find(".nodetree-langs a"),a.$nodeTree=a.$page.find(".root-tree").eq(0),a.init()};StackNodeTree.prototype.getCurrentPage=function(){var a=this;a.$nodeTree=a.$page.find(".root-tree").eq(0);var b=parseInt(a.$nodeTree.attr("data-page"));return isNaN(b)?1:b},StackNodeTree.prototype.getTranslationId=function(){var a=this;a.$nodeTree=a.$page.find(".root-tree").eq(0);var b=parseInt(a.$nodeTree.attr("data-translation-id"));return isNaN(b)?null:b},StackNodeTree.prototype.init=function(){var a=this;if(a.$quickAddNodeButtons.length){var b=$.proxy(a.onQuickAddClick,a);a.$quickAddNodeButtons.off("click",b),a.$quickAddNodeButtons.on("click",b)}if(a.$switchLangButtons.length){var c=$.proxy(a.onChangeLangClick,a);a.$switchLangButtons.off("click",c),a.$switchLangButtons.on("click",c)}},StackNodeTree.prototype.onChangeLangClick=function(a){var b=this;a.preventDefault();var c=$(a.currentTarget),d=parseInt(c.attr("data-children-parent-node")),e=parseInt(c.attr("data-translation-id")),f=c.attr("data-filter-tag");return b.refreshNodeTree(d,e,f),!1},StackNodeTree.prototype.onQuickAddClick=function(a){var b=this;b.currentRequest&&4!=b.currentRequest.readyState&&b.currentRequest.abort();var c=$(a.currentTarget),d=parseInt(c.attr("data-children-node-type")),e=parseInt(c.attr("data-children-parent-node"));if(d>0&&e>0){var f={_token:Rozier.ajaxToken,_action:"quickAddNode",nodeTypeId:d,parentNodeId:e,pushTop:1};isset(c.attr("data-filter-tag"))&&(f.tagId=parseInt(c.attr("data-filter-tag"))),b.currentRequest=$.ajax({url:Rozier.routes.nodesQuickAddAjax,type:"post",dataType:"json",data:f}).done(function(a){Rozier.refreshMainNodeTree(),b.refreshNodeTree(e,null,f.tagId,1),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log("error"),console.log(a),a=JSON.parse(a.responseText),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){console.log("complete")})}return!1},StackNodeTree.prototype.treeAvailable=function(){return!!this.$page.find(".nodetree-widget").length},StackNodeTree.prototype.refreshNodeTree=function(a,b,c,d){var e=this;e.currentRequest&&4!=e.currentRequest.readyState&&e.currentRequest.abort();var f=e.$page.find(".nodetree-widget");if(f.length){var g=f.find(".root-tree").eq(0);a=void 0===a?g.attr("data-parent-node-id")?parseInt(g.attr("data-parent-node-id")):null:parseInt(a),Rozier.lazyload.canvasLoader.show();var h={_token:Rozier.ajaxToken,_action:"requestNodeTree",stackTree:!0,parentNodeId:a,page:e.getCurrentPage(),translationId:e.getTranslationId()},i=Rozier.routes.nodesTreeAjax;isset(b)&&b>0&&(h.translationId=parseInt(b)),isset(h.translationId)&&null!==h.translationId&&(i+="/"+h.translationId),isset(d)&&(h.page=parseInt(d)),isset(c)&&(h.tagId=parseInt(c)),console.log("refresh stackNodeTree",h),e.currentRequest=$.ajax({url:i,type:"get",cache:!1,dataType:"json",data:h}).done(function(a){f.length&&void 0!==a.nodeTree&&f.fadeOut("slow",function(){if(f.replaceWith(a.nodeTree),f=e.$page.find(".nodetree-widget"),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.lazyload.bindAjaxLink(),f.fadeIn(),Rozier.resize(),new NodesBulk,e.$switchLangButtons=e.$page.find(".nodetree-langs a"),e.$nodeTree=e.$page.find(".root-tree").eq(0),e.$switchLangButtons.length){var b=$.proxy(e.onChangeLangClick,e);e.$switchLangButtons.off("click",b),e.$switchLangButtons.on("click",b)}Rozier.lazyload.canvasLoader.hide(),Rozier.lazyload.nodeTreeContextActions=new NodeTreeContextActions})}).fail(function(a){console.log(a.responseJSON)})}else console.error("No node-tree available.")};var NodeTypeFieldsPosition=function(){var a=this;a.$list=$(".node-type-fields > .uk-sortable"),a.currentRequest=null,a.init()};NodeTypeFieldsPosition.prototype.init=function(){var a=this;if(a.$list.length&&a.$list.children().length>1){var b=$.proxy(a.onSortableChange,a);a.$list.off("change.uk.sortable",b),a.$list.on("change.uk.sortable",b)}},NodeTypeFieldsPosition.prototype.onSortableChange=function(a,b,c){var d=this;d.currentRequest&&4!=d.currentRequest.readyState&&d.currentRequest.abort();var e=$(c),f=parseInt(e.data("field-id")),g=e.prev(),h=0;0===g.length?(g=e.next(),h=parseInt(g.data("position"))-.5):h=parseInt(g.data("position"))+.5,console.log("nodeTypeFieldId="+f+"; newPosition="+h);var i={_token:Rozier.ajaxToken,_action:"updatePosition",nodeTypeFieldId:f,newPosition:h};d.currentRequest=$.ajax({url:Rozier.routes.nodeTypesFieldAjaxEdit.replace("%nodeTypeFieldId%",f),type:"POST",dataType:"json",data:i}).done(function(a){e.attr("data-position",h),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)})},NodeTypeFieldEdit=function(){var a=this;a.$btn=$(".node-type-field-edit-button"),a.currentRequest=null,a.$btn.length&&(a.$formFieldRow=$(".node-type-field-row"),a.$formFieldCol=$(".node-type-field-col"),a.indexOpen=null,a.openFormDelay=0,a.$formCont=null,a.$form=null,a.$formIcon=null,a.$formContHeight=null,a.init())},NodeTypeFieldEdit.prototype.init=function(){},NodeTypeFieldEdit.prototype.btnClick=function(a){var b=this;return a.preventDefault(),null!==b.indexOpen?(b.closeForm(),b.openFormDelay=400):b.openFormDelay=0,b.indexOpen!==parseInt(a.currentTarget.getAttribute("data-index"))&&(b.currentRequest&&4!=b.currentRequest.readyState&&b.currentRequest.abort(),Rozier.lazyload.canvasLoader.show(),b.openTimeout&&clearTimeout(b.openTimeout),b.openTimeout=setTimeout(function(){var c=new CustomEvent("pagechange");window.dispatchEvent(c),b.indexOpen=parseInt(a.currentTarget.getAttribute("data-index")),b.currentRequest=$.ajax({url:a.currentTarget.href,type:"get",cache:!1,dataType:"html"}).done(function(c){b.applyContent(a.currentTarget,c,a.currentTarget.href)}).fail(function(){UIkit.notify({message:Rozier.messages.forbiddenPage,status:"danger",timeout:3e3,pos:"top-center"})}).always(function(){Rozier.lazyload.canvasLoader.hide()})},b.openFormDelay)),!1},NodeTypeFieldEdit.prototype.applyContent=function(a,b,c){var d=this,e=['<tr class="node-type-field-edit-form-row">','<td colspan="5">','<div class="node-type-field-edit-form-cont">',b,"</div>","</td>","</tr>"].join("");$(a).parent().parent().after(e),d.$formFieldCol.removeClass("node-type-field-col"),$(".rz-boolean-checkbox").bootstrapSwitch({size:"small"}),Rozier.lazyload.initMarkdownEditors(),setTimeout(function(){d.$formCont=$(".node-type-field-edit-form-cont"),d.formContHeight=d.$formCont.actual("height"),d.$formRow=$(".node-type-field-edit-form-row"),d.$form=$("#edit-node-type-field-form"),d.$formIcon=$(d.$formFieldRow[d.indexOpen]).find(".node-type-field-col-1 i"),d.$form.attr("action",c),d.$formIcon[0].className="uk-icon-chevron-down",d.$formCont[0].style.height="0px",d.$formCont[0].style.display="block",TweenLite.to(d.$form,.6,{height:d.formContHeight,ease:Expo.easeOut}),TweenLite.to(d.$formCont,.6,{height:d.formContHeight,ease:Expo.easeOut})},200)},NodeTypeFieldEdit.prototype.closeForm=function(){var a=this;a.$formIcon[0].className="uk-icon-chevron-right",TweenLite.to(a.$formCont,.4,{height:0,ease:Expo.easeOut,onComplete:function(){a.$formRow.remove(),a.indexOpen=null,a.$formFieldCol.addClass("node-type-field-col")}})},NodeTypeFieldEdit.prototype.resize=function(){};var CustomFormFieldsPosition=function(){var a=this;a.$list=$(".custom-form-fields > .uk-sortable"),a.init()};CustomFormFieldsPosition.prototype.init=function(){var a=this;if(a.$list.length&&a.$list.children().length>1){var b=$.proxy(a.onSortableChange,a);a.$list.off("change.uk.sortable",b),a.$list.on("change.uk.sortable",b)}},CustomFormFieldsPosition.prototype.onSortableChange=function(a,b,c){var d=$(c),e=parseInt(d.data("field-id")),f=d.prev(),g=0;0===f.length?(f=d.next(),g=parseInt(f.data("position"))-.5):g=parseInt(f.data("position"))+.5,console.log("customFormFieldId="+e+"; newPosition="+g);var h={_token:Rozier.ajaxToken,_action:"updatePosition",customFormFieldId:e,newPosition:g};$.ajax({url:Rozier.routes.customFormsFieldAjaxEdit.replace("%customFormFieldId%",e),type:"POST",dataType:"json",data:h}).done(function(a){d.attr("data-position",g),UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)})},CustomFormFieldEdit=function(){var a=this;a.$btn=$(".custom-form-field-edit-button"),a.$btn.length&&(a.$formFieldRow=$(".custom-form-field-row"),a.$formFieldCol=$(".custom-form-field-col"),a.indexOpen=null,a.openFormDelay=0,a.$formCont=null,a.$form=null,a.$formIcon=null,a.$formContHeight=null,a.init())},CustomFormFieldEdit.prototype.init=function(){var a=this,b=$.proxy(a.btnClick,a);a.$btn.off("click",b),a.$btn.on("click",b)},CustomFormFieldEdit.prototype.btnClick=function(a){var b=this;return a.preventDefault(),null!==b.indexOpen?(b.closeForm(),b.openFormDelay=500):b.openFormDelay=0,b.indexOpen!==parseInt(a.currentTarget.getAttribute("data-index"))&&(b.openTimeout&&clearTimeout(b.openTimeout),b.openTimeout=setTimeout(function(){b.indexOpen=parseInt(a.currentTarget.getAttribute("data-index")),$.ajax({url:a.currentTarget.href,type:"get",cache:!1,dataType:"html"}).done(function(c){b.applyContent(a.currentTarget,c,a.currentTarget.href)}).fail(function(){UIkit.notify({message:Rozier.messages.forbiddenPage,status:"danger",timeout:3e3,pos:"top-center"})})},b.openFormDelay)),!1},CustomFormFieldEdit.prototype.applyContent=function(a,b,c){var d=this,e=['<tr class="custom-form-field-edit-form-row">','<td colspan="4">','<div class="custom-form-field-edit-form-cont">',b,"</div>","</td>","</tr>"].join("");$(a).parent().parent().after(e),d.$formFieldCol.removeClass("custom-form-field-col"),$(".rz-boolean-checkbox").bootstrapSwitch({size:"small"}),Rozier.lazyload.initMarkdownEditors(),setTimeout(function(){d.$formCont=$(".custom-form-field-edit-form-cont"),d.formContHeight=d.$formCont.actual("height"),d.$formRow=$(".custom-form-field-edit-form-row"),d.$form=$("#edit-custom-form-field-form"),d.$formIcon=$(d.$formFieldRow[d.indexOpen]).find(".custom-form-field-col-1 i"),d.$form.attr("action",c),d.$formIcon[0].className="uk-icon-chevron-down",d.$formCont[0].style.height="0px",d.$formCont[0].style.display="block",TweenLite.to(d.$form,.6,{height:d.formContHeight,ease:Expo.easeOut}),TweenLite.to(d.$formCont,.6,{height:d.formContHeight,ease:Expo.easeOut})},200)},CustomFormFieldEdit.prototype.closeForm=function(){var a=this;a.$formIcon[0].className="uk-icon-chevron-right",TweenLite.to(a.$formCont,.4,{height:0,ease:Expo.easeOut,onComplete:function(){a.$formRow.remove(),a.indexOpen=null,a.$formFieldCol.addClass("custom-form-field-col")}})},CustomFormFieldEdit.prototype.resize=function(){};var EntriesPanel=function(){var a=this;a.$adminMenuNav=$("#admin-menu-nav"),a.replaceSubNavs()};EntriesPanel.prototype.replaceSubNavs=function(){this.$adminMenuNav.find(".uk-nav-sub").each(function(a,b){var c=$(b);c.attr("style","display:block;");var d=c.offset().top,e=c.height();c.removeAttr("style"),d+e+20>$(window).height()&&c.parent().addClass("reversed-nav")})};var Import=function(a){var b=this;b.routes=a,b.always(0),b.$nextStepButton=$("#next-step-button")};Import.prototype.routes=null,Import.prototype.score=0,Import.prototype.always=function(a){var b=this;b.routes.length>a?void 0!==b.routes[a].update?$.ajax({url:b.routes[a].update,type:"POST",dataType:"json",complete:function(){b.callSingleImport(a)}}):b.callSingleImport(a):b.$nextStepButton.length&&b.$nextStepButton.removeClass("uk-button-disabled")},Import.prototype.callSingleImport=function(a){var b=this,c=$("#"+b.routes[a].id),d=c.find("i");d.removeClass("uk-icon-circle-o"),d.addClass("uk-icon-spin"),d.addClass("uk-icon-spinner");var e={filename:b.routes[a].filename};$.ajax({url:b.routes[a].url,type:"POST",dataType:"json",data:e,success:function(e){d.removeClass("uk-icon-spinner"),d.addClass("uk-icon-check"),c.addClass("uk-badge-success"),b.routes[a].postUpdate?b.routes[a].postUpdate instanceof Array&&b.routes[a].postUpdate.length>1?$.ajax({
url:b.routes[a].postUpdate[0],type:"POST",dataType:"json",complete:function(){console.log("Calling: "+b.routes[a].postUpdate[0]),$.ajax({url:b.routes[a].postUpdate[1],type:"POST",dataType:"json",complete:function(){b.always(a+1)}})}}):$.ajax({url:b.routes[a].postUpdate,type:"POST",dataType:"json",complete:function(){b.always(a+1)}}):b.always(a+1)},error:function(a){d.removeClass("uk-icon-spinner"),d.addClass("uk-icon-warning"),c.addClass("uk-badge-danger"),a.responseJSON&&a.responseJSON.error&&c.parent().parent().after('<tr><td class="uk-alert uk-alert-danger" colspan="3">'+a.responseJSON.error+"</td></tr>")},complete:function(a){d.removeClass("uk-icon-spin")}})},RozierMobile=function(){var a=this;a.$menu=$("#menu-mobile"),a.$adminMenu=$("#admin-menu"),a.$adminMenuLink=a.$adminMenu.find("a"),a.$adminMenuNavParent=a.$adminMenu.find(".uk-parent"),a.$searchButton=$("#search-button"),a.$searchPanel=$("#nodes-sources-search"),a.$treeButton=$("#tree-button"),a.$treeWrapper=$("#tree-wrapper"),a.$treeWrapperLink=a.$treeWrapper.find("a"),a.$userPicture=$("#user-picture"),a.$userActions=$(".user-actions"),a.$userActionsLink=a.$userActions.find("a"),a.$mainContentOverlay=$("#main-content-overlay"),a.menuOpen=!1,a.searchOpen=!1,a.treeOpen=!1,a.adminOpen=!1,a.init()},RozierMobile.prototype.init=function(){var a=this;a.$userPicture.length&&addClass(a.$userPicture[0],"rz-no-ajax-link"),a.$menu.on("click",$.proxy(a.menuClick,a)),a.$adminMenuLink.on("click",$.proxy(a.adminMenuLinkClick,a)),a.$adminMenuNavParent.on("click",$.proxy(a.adminMenuNavParentClick,a)),a.$searchButton.on("click",$.proxy(a.searchButtonClick,a)),a.$treeButton.on("click",$.proxy(a.treeButtonClick,a)),a.$treeWrapperLink.on("click",$.proxy(a.treeWrapperLinkClick,a)),a.$userPicture.on("click",$.proxy(a.userPictureClick,a)),a.$userActionsLink.on("click",$.proxy(a.userActionsLinkClick,a)),a.$mainContentOverlay.on("click",$.proxy(a.mainContentOverlayClick,a))},RozierMobile.prototype.menuClick=function(a){var b=this;b.menuOpen?b.closeMenu():b.openMenu()},RozierMobile.prototype.adminMenuNavParentClick=function(a){var b=$(a.currentTarget),c=$(a.currentTarget).find(".uk-nav-sub");if(b.hasClass("nav-open"))TweenLite.to(c,.6,{height:0,ease:Expo.easeOut,onComplete:function(){c[0].style.display="none"}}),b.removeClass("nav-open");else{var d=c.find(".uk-nav-sub-item"),e=41*d.length-3;c[0].style.display="block",TweenLite.to(c,.6,{height:e,ease:Expo.easeOut,onComplete:function(){}}),b.addClass("nav-open")}},RozierMobile.prototype.adminMenuLinkClick=function(a){var b=this;b.menuOpen&&b.closeMenu()},RozierMobile.prototype.openMenu=function(){var a=this;a.searchOpen?a.closeSearch():a.treeOpen?a.closeTree():a.userOpen&&a.closeUser(),TweenLite.to(a.$adminMenu,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),a.menuOpen=!0},RozierMobile.prototype.closeMenu=function(){var a=this,b=.8*-Rozier.windowWidth;TweenLite.to(a.$adminMenu,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),a.menuOpen=!1},RozierMobile.prototype.searchButtonClick=function(a){var b=this;b.searchOpen?b.closeSearch():b.openSearch()},RozierMobile.prototype.openSearch=function(){var a=this;a.menuOpen?a.closeMenu():a.treeOpen?a.closeTree():a.userOpen&&a.closeUser(),TweenLite.to(a.$searchPanel,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),a.$searchButton.addClass("active"),a.searchOpen=!0},RozierMobile.prototype.closeSearch=function(){var a=this,b=.8*-Rozier.windowWidth;TweenLite.to(a.$searchPanel,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),a.$searchButton.removeClass("active"),a.searchOpen=!1},RozierMobile.prototype.treeButtonClick=function(a){var b=this;b.treeOpen?b.closeTree():b.openTree()},RozierMobile.prototype.treeWrapperLinkClick=function(a){var b=this;a.currentTarget.className.indexOf("tab-link")==-1&&b.treeOpen&&b.closeTree()},RozierMobile.prototype.openTree=function(){var a=this;a.menuOpen?a.closeMenu():a.searchOpen?a.closeSearch():a.userOpen&&a.closeUser(),TweenLite.to(a.$treeWrapper,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),a.$treeButton.addClass("active"),a.treeOpen=!0},RozierMobile.prototype.closeTree=function(){var a=this,b=.8*-Rozier.windowWidth;TweenLite.to(a.$treeWrapper,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),removeClass(a.$treeButton[0],"active"),a.treeOpen=!1},RozierMobile.prototype.userPictureClick=function(a){var b=this;return b.userOpen?b.closeUser():b.openUser(),!1},RozierMobile.prototype.userActionsLinkClick=function(a){var b=this;b.userOpen&&b.closeUser()},RozierMobile.prototype.openUser=function(){var a=this;a.menuOpen?a.closeMenu():a.searchOpen?a.closeSearch():a.treeOpen&&a.closeTree(),TweenLite.to(a.$userActions,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay.length&&(a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut})),a.$userPicture.addClass("active"),a.userOpen=!0},RozierMobile.prototype.closeUser=function(){var a=this,b=.8*Rozier.windowWidth;TweenLite.to(a.$userActions,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),a.$userPicture.removeClass("active"),a.userOpen=!1},RozierMobile.prototype.mainContentOverlayClick=function(a){var b=this;b.menuOpen?b.closeMenu():b.treeOpen?b.closeTree():b.userOpen&&b.closeUser()},RozierMobile.prototype.resize=function(){};var Lazyload=function(){var a=this;a.$linksSelector=null,a.$textareasMarkdown=null,a.documentsList=null,a.mainColor=null,a.$canvasLoaderContainer=null,a.currentRequest=null;var b=$.proxy(a.onPopState,a);a.parseLinks(),window.addEventListener("load",function(){setTimeout(function(){$(window).off("popstate",b),$(window).on("popstate",b)},0)}),a.$canvasLoaderContainer=$("#canvasloader-container"),a.mainColor=isset(Rozier.mainColor)?Rozier.mainColor:"#ffffff",a.initLoader(),history.pushState({},null,window.location.href)};Lazyload.prototype.initLoader=function(){var a=this;a.canvasLoader=new CanvasLoader("canvasloader-container"),a.canvasLoader.setColor(a.mainColor),a.canvasLoader.setShape("square"),a.canvasLoader.setDensity(90),a.canvasLoader.setRange(.8),a.canvasLoader.setSpeed(4),a.canvasLoader.setFPS(30)},Lazyload.prototype.parseLinks=function(){this.$linksSelector=$("a:not('[target=_blank]')").not(".rz-no-ajax-link")},Lazyload.prototype.onClick=function(a){var b=this,c=$(a.currentTarget),d=c.attr("href");if(void 0!==d&&!c.hasClass("rz-no-ajax-link")&&""!==d&&"#"!=d&&(d.indexOf(Rozier.baseUrl)>=0||"/"==d.charAt(0)||"?"==d.charAt(0)))return a.preventDefault(),b.clickTimeout&&clearTimeout(b.clickTimeout),b.clickTimeout=window.setTimeout(function(){history.pushState({},null,c.attr("href")),b.onPopState(null)},50),!1},Lazyload.prototype.onPopState=function(a){var b=this,c=null;null!==a&&(c=a.originalEvent.state),void 0!==c&&null!==c||(c=window.history.state),null!==c&&(b.canvasLoader.show(),b.loadContent(c,window.location))},Lazyload.prototype.loadContent=function(a,b){var c=this;c.currentTimeout&&clearTimeout(c.currentTimeout),c.currentTimeout=window.setTimeout(function(){var d=new CustomEvent("pagechange");window.dispatchEvent(d),c.currentRequest=$.ajax({url:b.href,type:"get",dataType:"html",cache:!1,data:a.headerData}).done(function(a){c.applyContent(a),c.canvasLoader.hide();var b=new CustomEvent("pageload",{detail:a});window.dispatchEvent(b)}).fail(function(a){if(console.log(a),void 0!==a.responseText)try{var d=JSON.parse(a.responseText);UIkit.notify({message:d.message,status:"danger",timeout:3e3,pos:"top-center"})}catch(e){window.location.href=b.href}else UIkit.notify({message:Rozier.messages.forbiddenPage,status:"danger",timeout:3e3,pos:"top-center"});c.canvasLoader.hide()})},100)},Lazyload.prototype.applyContent=function(a){var b=this,c=$("#main-content-scrollable"),d=c.find(".content-global"),e=$(a);e.addClass("new-content-global"),c.append(e),e=c.find(".new-content-global"),d.fadeOut(100,function(){d.remove(),b.generalBind(),e.fadeIn(200,function(){e.removeClass("new-content-global")})})},Lazyload.prototype.bindAjaxLink=function(){var a=this;a.parseLinks();var b=$.proxy(a.onClick,a);a.$linksSelector.off("click",b),a.$linksSelector.on("click",b)},Lazyload.prototype.generalBind=function(){var a=this;a.bindAjaxLink(),new DocumentsBulk,new AutoUpdate,new NodesBulk,new TagsBulk,new InputLengthWatcher,new DocumentUploader(Rozier.messages.dropzone),a.childrenNodesFields=new ChildrenNodesField,new GeotagField,new MultiGeotagField,a.stackNodeTrees=new StackNodeTree,null===isMobile.any()&&new SaveButtons,new TagAutocomplete,new FolderAutocomplete,new NodeTypeFieldsPosition,new CustomFormFieldsPosition,a.nodeTreeContextActions=new NodeTreeContextActions,a.settingsSaveButtons=new SettingsSaveButtons,a.nodeTypeFieldEdit=new NodeTypeFieldEdit,a.nodeEditSource=new NodeEditSource,a.nodeTree=new NodeTree,a.customFormFieldEdit=new CustomFormFieldEdit,a.initMarkdownEditors(),a.initJsonEditors(),a.initCssEditors(),a.initYamlEditors(),a.initFilterBars(),$(".colorpicker-input").length&&$(".colorpicker-input").minicolors(),$(".actions-menu").length&&null===isMobile.any()&&TweenLite.to(".actions-menu",.5,{right:0,delay:.4,ease:Expo.easeOut}),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.nodeStatuses=new NodeStatuses,a.initBootstrapSwitches(),Rozier.getMessages(),void 0!==Rozier.importRoutes&&null!==Rozier.importRoutes&&(Rozier.import=new Import(Rozier.importRoutes),Rozier.importRoutes=null)},Lazyload.prototype.initBootstrapSwitches=function(){$(".rz-boolean-checkbox").bootstrapSwitch({size:"small"})},Lazyload.prototype.initMarkdownEditors=function(){var a=this;a.$textareasMarkdown=$("textarea[data-rz-markdowneditor]");var b=a.$textareasMarkdown.length;b&&setTimeout(function(){for(var c=0;c<b;c++)new MarkdownEditor(a.$textareasMarkdown.eq(c),c)},100)},Lazyload.prototype.initJsonEditors=function(){var a=this;a.$textareasJson=$("textarea[data-rz-jsoneditor]");var b=a.$textareasJson.length;b&&setTimeout(function(){for(var c=0;c<b;c++)new JsonEditor(a.$textareasJson.eq(c),c)},100)},Lazyload.prototype.initCssEditors=function(){var a=this;a.$textareasCss=$("textarea[data-rz-csseditor]");var b=a.$textareasCss.length;b&&setTimeout(function(){for(var c=0;c<b;c++)new CssEditor(a.$textareasCss.eq(c),c)},100)},Lazyload.prototype.initYamlEditors=function(){var a=this;a.$textareasYaml=$("textarea[data-rz-yamleditor]");var b=a.$textareasYaml.length;b&&setTimeout(function(){for(var c=0;c<b;c++)new YamlEditor(a.$textareasYaml.eq(c),c)},100)},Lazyload.prototype.initFilterBars=function(){var a=$("select.item-per-page");a.length&&(a.off("change"),a.on("change",function(a){$(a.currentTarget).parents("form").submit()}))},Lazyload.prototype.resize=function(){this.$canvasLoaderContainer[0].style.left=Rozier.mainContentScrollableOffsetLeft+Rozier.mainContentScrollableWidth/2+"px"};var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},toType=function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var stripTags=function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},isset=function(a){return!!a},addClass=function(a,b){a&&(a.classList?a.classList.add(b):a.className+=" "+b)},removeClass=function(a,b){if(a)if(a.classList)a.classList.remove(b);else{a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi"),"");var c=a.className.length-1;" "==a.className[c]&&(a.className=a.className.substring(0,c))}};PointerEventsPolyfill.initialize=function(a){return null==PointerEventsPolyfill.singleton&&(PointerEventsPolyfill.singleton=new PointerEventsPolyfill(a)),PointerEventsPolyfill.singleton},PointerEventsPolyfill.prototype.register_mouse_events=function(){$(document).on(this.options.mouseEvents.join(" "),this.options.selector,function(a){if("none"==$(this).css("pointer-events")){var b=$(this).css("display");$(this).css("display","none");var c=document.elementFromPoint(a.clientX,a.clientY);return b?$(this).css("display",b):$(this).css("display",""),a.target=c,$(c).trigger(a),!1}return!0})};var Rozier={};Rozier.$window=null,Rozier.$body=null,Rozier.windowWidth=null,Rozier.windowHeight=null,Rozier.resizeFirst=!0,Rozier.gMapLoading=!1,Rozier.gMapLoaded=!1,Rozier.searchNodesSourcesDelay=null,Rozier.nodeTrees=[],Rozier.treeTrees=[],Rozier.$userPanelContainer=null,Rozier.$minifyTreePanelButton=null,Rozier.$mainTrees=null,Rozier.$mainTreesContainer=null,Rozier.$mainTreeElementName=null,Rozier.$treeContextualButton=null,Rozier.$nodesSourcesSearch=null,Rozier.nodesSourcesSearchHeight=null,Rozier.$nodeTreeHead=null,Rozier.nodeTreeHeadHeight=null,Rozier.$treeScrollCont=null,Rozier.$treeScroll=null,Rozier.treeScrollHeight=null,Rozier.$mainContentScrollable=null,Rozier.mainContentScrollableWidth=null,Rozier.mainContentScrollableOffsetLeft=null,Rozier.$backTopBtn=null,Rozier.entriesPanel=null,Rozier.onDocumentReady=function(a){for(var b in temp)Rozier[b]=temp[b];Rozier.lazyload=new Lazyload,Rozier.entriesPanel=new EntriesPanel,Rozier.$window=$(window),Rozier.$body=$("body"),Rozier.$userPanelContainer=$("#user-panel-container"),Rozier.$minifyTreePanelButton=$("#minify-tree-panel-button"),Rozier.$mainTrees=$("#main-trees"),Rozier.$mainTreesContainer=$("#main-trees-container"),Rozier.$nodesSourcesSearch=$("#nodes-sources-search"),Rozier.$mainContentScrollable=$("#main-content-scrollable"),Rozier.$backTopBtn=$("#back-top-button"),Modernizr.testProp("pointerEvents")||PointerEventsPolyfill.initialize({selector:"#main-trees-overlay"}),Rozier.$minifyTreePanelButton.on("click",Rozier.toggleTreesPanel),document.body.addEventListener("markdownPreviewOpen",Rozier.openTreesPanel,!1),Rozier.$backTopBtn.on("click",$.proxy(Rozier.backTopBtnClick,Rozier)),Rozier.$window.on("resize",$.proxy(Rozier.resize,Rozier)),Rozier.$window.trigger("resize"),Rozier.lazyload.generalBind(),Rozier.bindMainNodeTreeLangs()},Rozier.initNestables=function(){$(".uk-nestable").each(function(a,b){var c=$(b),d={handleClass:"uk-nestable-handle"};c.hasClass("nodetree")?d.group="nodeTree":c.hasClass("tagtree")?d.group="tagTree":c.hasClass("foldertree")&&(d.group="folderTree"),UIkit.nestable(b,d)})},Rozier.bindMainTrees=function(){var a=this,b=$(".nodetree-widget .root-tree");b.off("change.uk.nestable"),b.on("change.uk.nestable",Rozier.onNestableNodeTreeChange);var c=$(".tagtree-widget .root-tree");c.off("change.uk.nestable"),c.on("change.uk.nestable",Rozier.onNestableTagTreeChange);var d=$(".foldertree-widget .root-tree");d.off("change.uk.nestable"),d.on("change.uk.nestable",Rozier.onNestableFolderTreeChange),a.$mainTreeElementName=a.$mainTrees.find(".tree-element-name"),a.$mainTreeElementName.off("contextmenu",$.proxy(a.maintreeElementNameRightClick,a)),a.$mainTreeElementName.on("contextmenu",$.proxy(a.maintreeElementNameRightClick,a))},Rozier.maintreeElementNameRightClick=function(a){var b=$(a.currentTarget).parent().find(".tree-contextualmenu");return b.length&&(b[0].className.indexOf("uk-open")==-1?b.addClass("uk-open"):b.removeClass("uk-open")),!1},Rozier.bindMainNodeTreeLangs=function(){$("body").on("click","#tree-container .nodetree-langs a",function(a){Rozier.lazyload.canvasLoader.show();var b=$(a.currentTarget),c=parseInt(b.attr("data-translation-id"));return Rozier.refreshMainNodeTree(c),!1})},Rozier.getMessages=function(){$.ajax({url:Rozier.routes.ajaxSessionMessages,type:"GET",dataType:"json",cache:!1,data:{_action:"messages",_token:Rozier.ajaxToken}}).done(function(a){if(void 0!==a.messages){if(void 0!==a.messages.confirm&&a.messages.confirm.length>0)for(var b=a.messages.confirm.length-1;b>=0;b--)UIkit.notify({message:a.messages.confirm[b],status:"success",timeout:2e3,pos:"top-center"});if(void 0!==a.messages.error&&a.messages.error.length>0)for(var c=a.messages.error.length-1;c>=0;c--)UIkit.notify({message:a.messages.error[c],status:"error",timeout:2e3,pos:"top-center"})}}).fail(function(){console.log("[Rozier.getMessages] error")})},Rozier.refreshAllNodeTrees=function(a){var b=this;if(b.refreshMainNodeTree(a),b.lazyload.stackNodeTrees.treeAvailable()&&b.lazyload.stackNodeTrees.refreshNodeTree(),b.lazyload.childrenNodesFields.treeAvailable())for(var c=b.lazyload.childrenNodesFields.$nodeTrees.length-1;c>=0;c--){var d=b.lazyload.childrenNodesFields.$nodeTrees.eq(c);b.lazyload.childrenNodesFields.refreshNodeTree(d)}},Rozier.refreshMainNodeTree=function(a){var b=this,c=$("#tree-container").find(".nodetree-widget"),d=c.find(".root-tree").eq(0);if(c.length){var e={_token:Rozier.ajaxToken,_action:"requestMainNodeTree"};d.length&&!isset(a)&&(a=parseInt(d.attr("data-translation-id")));var f=Rozier.routes.nodesTreeAjax;isset(a)&&a>0&&(f+="/"+a),$.ajax({url:f,type:"get",cache:!1,dataType:"json",data:e}).done(function(a){c.length&&void 0!==a.nodeTree&&c.fadeOut("slow",function(){c.replaceWith(a.nodeTree),c=$("#tree-container").find(".nodetree-widget"),c.fadeIn(),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.resize(),Rozier.lazyload.bindAjaxLink(),b.lazyload.nodeTreeContextActions=new NodeTreeContextActions})}).fail(function(a){console.log(a.responseJSON)}).always(function(){Rozier.lazyload.canvasLoader.hide()})}else console.error("No main node-tree available.")},Rozier.toggleTreesPanel=function(a){return $("#main-trees").toggleClass("minified"),$("#main-content").toggleClass("maximized"),$("#minify-tree-panel-button i").toggleClass("uk-icon-rz-panel-tree-open"),$("#minify-tree-panel-area").toggleClass("tree-panel-hidden"),!1},Rozier.openTreesPanel=function(a){return $("#main-trees").hasClass("minified")&&Rozier.toggleTreesPanel(null),!1},Rozier.toggleUserPanel=function(a){return $("#user-panel").toggleClass("minified"),!1},Rozier.onSearchNodesSources=function(a){var b=$(a.currentTarget);27==a.keyCode&&b.blur(),b.val().length>1&&(clearTimeout(Rozier.searchNodesSourcesDelay),Rozier.searchNodesSourcesDelay=setTimeout(function(){var a={_token:Rozier.ajaxToken,_action:"searchNodesSources",searchTerms:b.val()};console.log(a),$.ajax({url:Rozier.routes.searchNodesSourcesAjax,type:"GET",dataType:"json",data:a}).done(function(a){var b=$("#nodes-sources-search-results");if(void 0!==a.data&&a.data.length>0){b.empty();for(var c in a.data)b.append('<li><a href="'+a.data[c].url+'" style="border-left-color:'+a.data[c].typeColor+'"><span class="title">'+a.data[c].title+'</span> <span class="type">'+a.data[c].typeName+"</span></a></li>")}else b.empty()}).fail(function(a){$("#nodes-sources-search-results").empty()})},200))},Rozier.onSubmitSearchNodesSources=function(a){return!1},Rozier.onNestableNodeTreeChange=function(a,b,c,d){var e=$(c);if("removed"==d)return!1;var f=parseInt(e.attr("data-node-id")),g=null;if(e.parents(".nodetree-element").length?g=parseInt(e.parents(".nodetree-element").eq(0).attr("data-node-id")):e.parents(".stack-tree-widget").length?g=parseInt(e.parents(".stack-tree-widget").eq(0).attr("data-parent-node-id")):e.parents(".children-node-widget").length&&(g=parseInt(e.parents(".children-node-widget").eq(0).attr("data-parent-node-id"))),isNaN(g)&&(g=null),f===g)return console.log("You cannot move a node inside itself!"),window.location.reload(),!1;var h={_token:Rozier.ajaxToken,_action:"updatePosition",nodeId:f,newParent:g};e.next().length&&void 0!==e.next().attr("data-node-id")?h.nextNodeId=parseInt(e.next().attr("data-node-id")):e.prev().length&&void 0!==e.prev().attr("data-node-id")&&(h.prevNodeId=parseInt(e.prev().attr("data-node-id"))),console.log(h),$.ajax({url:Rozier.routes.nodeAjaxEdit.replace("%nodeId%",f),type:"POST",dataType:"json",data:h}).done(function(a){UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.err(a)})},Rozier.onNestableTagTreeChange=function(a,b,c,d){var e=$(c);if("removed"==d)return!1;var f=parseInt(e.attr("data-tag-id")),g=null;if(e.parents(".tagtree-element").length?g=parseInt(e.parents(".tagtree-element").eq(0).attr("data-tag-id")):e.parents(".root-tree").length&&(g=parseInt(e.parents(".root-tree").eq(0).attr("data-parent-tag-id"))),isNaN(g)&&(g=null),f===g)return console.log("You cannot move a tag inside itself!"),alert("You cannot move a tag inside itself!"),window.location.reload(),!1;var h={_token:Rozier.ajaxToken,_action:"updatePosition",tagId:f,newParent:g};e.next().length&&void 0!==e.next().attr("data-tag-id")?h.nextTagId=parseInt(e.next().attr("data-tag-id")):e.prev().length&&void 0!==e.prev().attr("data-tag-id")&&(h.prevTagId=parseInt(e.prev().attr("data-tag-id"))),console.log(h),$.ajax({url:Rozier.routes.tagAjaxEdit.replace("%tagId%",f),type:"POST",dataType:"json",data:h}).done(function(a){UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.err(a)})},Rozier.onNestableFolderTreeChange=function(a,b,c,d){var e=$(c);if("removed"==d)return!1;var f=parseInt(e.attr("data-folder-id")),g=null;if(e.parents(".foldertree-element").length?g=parseInt(e.parents(".foldertree-element").eq(0).attr("data-folder-id")):e.parents(".root-tree").length&&(g=parseInt(e.parents(".root-tree").eq(0).attr("data-parent-folder-id"))),isNaN(g)&&(g=null),f===g)return console.log("You cannot move a folder inside itself!"),alert("You cannot move a folder inside itself!"),window.location.reload(),!1;var h={_token:Rozier.ajaxToken,_action:"updatePosition",folderId:f,newParent:g};e.next().length&&void 0!==e.next().attr("data-folder-id")?h.nextFolderId=parseInt(e.next().attr("data-folder-id")):e.prev().length&&void 0!==e.prev().attr("data-folder-id")&&(h.prevFolderId=parseInt(e.prev().attr("data-folder-id"))),console.log(h),$.ajax({url:Rozier.routes.folderAjaxEdit.replace("%folderId%",f),type:"POST",dataType:"json",data:h}).done(function(a){UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.err(a)})},Rozier.backTopBtnClick=function(a){var b=this;return TweenLite.to(b.$mainContentScrollable,.6,{scrollTo:{y:0},ease:Expo.easeOut}),!1},Rozier.resize=function(){var a=this;a.windowWidth=a.$window.width(),a.windowHeight=a.$window.height(),a.windowWidth>=768&&a.windowWidth<=1200&&a.resizeFirst&&(a.$mainTrees[0].style.display="none",a.$minifyTreePanelButton.trigger("click"),setTimeout(function(){a.$mainTrees[0].style.display="table-cell"},1e3)),a.windowWidth<=768&&a.resizeFirst&&(a.mobile=new RozierMobile),a.windowWidth>=768?(a.$mainContentScrollable.height(a.windowHeight),a.$mainTreesContainer[0].style.height=""):(a.$mainContentScrollable[0].style.height="",a.$mainTreesContainer.height(a.windowHeight)),a.$nodeTreeHead=a.$mainTrees.find(".nodetree-head"),a.$treeScrollCont=a.$mainTrees.find(".tree-scroll-cont"),a.$treeScroll=a.$mainTrees.find(".tree-scroll"),a.nodesSourcesSearchHeight=a.$nodesSourcesSearch.actual("outerHeight"),a.nodeTreeHeadHeight=a.$nodeTreeHead.actual("outerHeight"),a.treeScrollHeight=a.windowHeight-(a.nodesSourcesSearchHeight+a.nodeTreeHeadHeight),null!==isMobile.any()&&(a.treeScrollHeight=a.windowHeight-(100+a.nodeTreeHeadHeight));for(var b=0;b<a.$treeScrollCont.length;b++)a.$treeScrollCont[b].style.height=a.treeScrollHeight+"px";a.mainContentScrollableWidth=a.$mainContentScrollable.width(),a.mainContentScrollableOffsetLeft=a.windowWidth-a.mainContentScrollableWidth,a.lazyload.resize(),a.entriesPanel.replaceSubNavs(),a.resizeFirst&&(a.resizeFirst=!1)},$(document).ready(Rozier.onDocumentReady);